(function(){function t(a,b,c,e,f,g){f=f||[];Array.isArray(f)||(f=[f]);if(2<b.length)throw console.log({m:"UTIL.decorateElement: too many ids",spec,attrs:e,names:b}),Error("UTIL.decorateElement: too many ids");for(1<b.length&&a.setAttribute("id",b[1]);0<c.length;)a.classList.add(c.shift());for(e&&Object.entries(e).forEach(([h,k])=>{"style"===h?Object.entries(k).forEach(([n,m])=>{a.style[n]=m}):"dataset"===h?Object.entries(k).forEach(([n,m])=>{a.dataset[n]=m}):a.setAttribute(h,k)});0<f.length;)if(b=
f.shift(),"string"==typeof b)for(c=document.createElement("div"),c.innerHTML=b;c.firstChild;)a.appendChild(c.firstChild);else a.appendChild(b);if(g){f=g(a);if(f instanceof HTMLElement)return f;console.error(Error("UTIL.decorateElement decorator function did not return a DOM node"))}return a}function w(a){if(7==a.length)return[parseInt(a[1]+a[2],16),parseInt(a[3]+a[4],16),parseInt(a[5]+a[6],16)];if(4==a.length)return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)];console.error(`UTIL.hextoInts: Bad hex string value ${a}.`);
return[0,0,0]}function x(a,b,c){return"#"+u(a)+u(b)+u(c)}function u(a){a=Math.round(a).toString(16);1==a.length&&(a="0"+a);return a}function v(){this.__indent=0}function r(){this.__indent=0}function y(a,b,c){this.name=a;this.route=b;this.help=c}NgChm.markFile();const d=NgChm.createNS("NgChm.UTIL"),A=NgChm.importNS("NgChm.CFG");d.getURLParameter=function(a){return decodeURIComponent(((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||""};d.mapId=d.getURLParameter("map");
d.mapNameRef=d.getURLParameter("name");d.getDebugFlag=function(a){return d.getURLParameter("debug").split(",").includes(a)};d.getFeatureFlag=function(a){return d.getURLParameter("feature").split(",").includes(a)};d.capitalize=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)};(function(){d.passiveCompat=function(){var a=!1;const b=function(){};try{var c=Object.defineProperty({},"passive",{get(){a=!0}});window.addEventListener("test",b,c);window.removeEventListener("test",b,c)}catch(e){}return a}()?
a=>a:a=>!!a.capture})();const z=new Map;d.setKeyData=function(a,b){z.set(a,b)};d.getKeyData=function(a){return z.get(a)};d.setKeyData("web-builder-url",A.builder_url);d.addScript=function(a,b){const c=document.getElementsByTagName("head")[0];a=d.newElement("script",{type:"text/javascript",src:a});c.appendChild(a);a.onload=b;a.onreadystatechange=function(){"complete"==this.readyState&&b()}};d.addScripts=function(a,b){d.addScript(a[0],()=>{1===a.length?b():d.addScripts(a.slice(1),b)})};d.setElementPositionSize=
function(a,b,c){a&&a.style||console.error("setElementPositionSize on non-element",a);b.left&&(a.style.left=b.left+"px");b.top&&(a.style.top=b.top+"px");a.style.width=b.width+"px";a.style.height=b.height+"px";c||"CANVAS"!==a.tagName||(a.width=Math.round(b.width),a.height=Math.round(b.height))};d.newTxt=function(a){return document.createTextNode(a)};d.newSvgButton=function(a,b,c){a=a.split(".");const e=a.shift().split("#"),f=e[0].split("!"),g=d.newElement("BUTTON");g.innerHTML=f.map(h=>'<SVG width="1em" height="1em"><USE href="icons.svg#'+
h+'"/></SVG>').join("");return t(g,e,a,b,[],c)};d.newSvgMenuItem=function(a,b,c){a=a.split(".");const e=a.shift().split("#"),f=e[0].split("!"),g=d.newElement("DIV.menuSvg");g.innerHTML=f.map(h=>'<SVG width="1em" height="1em"><USE href="icons.svg#'+h+'"/></SVG>').join("");return t(g,e,a,b,[],c)};d.newElement=function(a,b,c,e){a=a.split(".");const f=a.shift().split("#"),g=document.createElement(f[0]);return t(g,f,a,b,c,e)};d.newFragment=function(a){const b=document.createDocumentFragment();a.forEach(c=>
{b.appendChild(c)});return b};d.newButton=function(a,b,c){a=d.newElement("SPAN.button",{},[d.newTxt(a)]);for(const e of Object.entries(c))a.addEventListener(e[0],e[1]);return a};d.newSelect=function(a,b){a.length!=b.length&&console.error("UTIL.newSelect: values and contents do not have the same length",{values:a,contents:b});const c=d.newElement("SELECT");for(let e=0;e<a.length;e++){const f=d.newElement("OPTION");f.value=a[e];f.innerText=b[e];c.appendChild(f)}return c};d.createPopupPanel=function(a){const b=
document.getElementById(a);return b?(b.classList.add("ngchm-popup"),b.style.display="none",b):d.newElement("DIV.ngchm-popup",{id:a,style:{display:"none"}})};d.showTab=function(a){const b=document.getElementById(a);b||console.error("No tab button identified by buttonId:",{buttonId:a});(function(e){[...e.children].forEach(f=>{const g=document.getElementById(f.dataset.forTab);g||console.error("No tab identified by button:",{btn:f});g.classList.add("hide");f.classList.remove("selected")})})(b.parentElement);
const c=b.dataset.forTab&&document.getElementById(b.dataset.forTab);c||console.error("No tab identified by buttonId:",{buttonId:a});c.classList.remove("hide");b.classList.add("selected")};d.toTitleCase=function(a){return a.toLowerCase().replace(/_/g," ").replace(/\b([a-z\u00C0-\u00ff])/g,function(b,c){return c.toUpperCase()}).replace(/(\s(?:de|a|o|e|da|do|em|ou|[\u00C0-\u00ff]))\b/gi,function(b,c){return c.toLowerCase()})};d.getStyle=function(a,b){if(a.currentStyle)var c=a.currentStyle[b];else window.getComputedStyle&&
(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b));return c};d.returnToHome=function(){var a=d.getURLParameter("collectionHome");""!==a&&window.open(a,"_self")};d.isScreenZoomed=function(){var a=0;.89>window.devicePixelRatio?a=-1:1.375<window.devicePixelRatio&&(a=1);return a};d.getBrowserType=function(){var a="unknown";if(-1!=(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR")))a="Opera";else if(-1!=navigator.userAgent.indexOf("Chrome"))a="Chrome";else if(-1!=
navigator.userAgent.indexOf("Safari"))a="Safari";else if(-1!=navigator.userAgent.indexOf("Firefox"))a="Firefox";else if(-1!=navigator.userAgent.indexOf("MSIE")||1==!!document.documentMode)a="IE";return a};d.minLabelSize=5;d.showSummaryPane=!0;d.showDetailPane=!0;d.blendTwoColors=function(a,b,c){a||(console.warn("UTIL.blendTwoColors: missing color1. Using black."),a="#000000");b||(console.warn("UTIL.blendTwoColors: missing color2. Using white."),b="#ffffff");Array.isArray(a)||(a=w(a));Array.isArray(b)||
(b=w(b));"undefined"==typeof c&&(c=.5);return x.apply(null,[(1-c)*a[0]+c*b[0],(1-c)*a[1]+c*b[1],(1-c)*a[2]+c*b[2]])};d.hsvToRgb=function(a,b,c){a/=60;b/=100;c/=100;const e=Math.floor(a);a-=e;const f=1-b,g=1-a*b,h=1-(1-a)*b;c*=256-1E-10;b=function(k){switch(k%6){case 0:return[1,h,f];case 1:return[g,1,f];case 2:return[f,1,h];case 3:return[f,g,1];case 4:return[h,f,1];case 5:return[1,f,g]}}(e).map(k=>Math.floor(k*c));return x.apply(null,b)};d.pick=function(a,b){const c=[0],e=Math.floor(b/(a-1)),f=b/(a-
1)-e;let g=f;for(let h=1;h<a;h++){let k=e;1<=g&&(k++,--g);g+=f;c.push(Math.min(c[c.length-1]+k,b-1))}return c};d.convertToArray=function(a){var b=[];b.push(a);return b};d.containerElement=document.getElementById("ngChmContainer");d.removeElementsByClass=function(a){for(a=document.getElementsByClassName(a);0<a.length;)a[0].parentNode.removeChild(a[0])};d.shadeColor=function(a,b){var c=b/100;b=parseInt(a.slice(1),16);a=0>c?0:255;c=0>c?-1*c:c;var e=b>>16,f=b>>8&255;b&=255;return"#"+(16777216+65536*(Math.round((a-
e)*c)+e)+256*(Math.round((a-f)*c)+f)+(Math.round((a-b)*c)+b)).toString(16).slice(1)};d.imageCanvas=function(a){let b=document.createElement("canvas");const c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b};d.isNaN=function(a){let b;b=isNaN(a);""===a.trim()&&(b=!0);return b};d.isValidURL=function(a){try{new URL(a)}catch(b){return!1}return!0};d.dragElement=function(a){function b(l){l=l||window.event;l.preventDefault();const q=a.getBoundingClientRect();g=l.clientX-q.x;
h=l.clientY-q.y;n=-q.width/2;m=window.innerWidth-q.width/2;l=p.getBoundingClientRect();k=window.innerHeight-l.height;document.onmouseup=e;document.onmousemove=c}function c(l){l=l||window.event;l.preventDefault();const q=l.clientY-h;a.style.left=Math.min(m,Math.max(n,l.clientX-g))+"px";a.style.top=Math.min(k,Math.max(-2,q))+"px";l=document.getElementById("content").clientHeight;a.style.height="";a.offsetHeight>f+l&&(a.style.height=f+l+"px")}function e(){document.onmouseup=null;document.onmousemove=
null}const f=document.getElementById("mdaServiceHeader").clientHeight;let g=0,h=0,k=0,n=0,m=0;const p=document.getElementById(a.id+"Hdr")||a.querySelector(".msgBoxHdr");p&&(p.onmousedown=b)};d.roundUpDown=function(a,b){var c=a,e=a%10;5===b?c=5>e&&3<=e||5<e&&7<=e?5*Math.ceil(a/5):5*Math.floor(a/5):10===b&&(c=5<=e?10*Math.ceil(a/10):10*Math.floor(a/10));return c};d.createCheckBoxDropDown=function(a,b,c,e,f){function g(k){d.toggleCheckBox(k,k.target)}b=document.getElementById(b);var h=document.getElementById(a);
a=[];for(let k=0;k<e.length;k++)a.push(e[k]);a.sort((k,n)=>k.localeCompare(n,void 0,{sensitivity:"base"}));h.innerHTML="<select><option>"+c+"</option></select><div id='overSelect' class='dropDownOverSelect'></div>";c="";for(h=0;h<a.length;h++)c=c+"<label for='"+a[h]+"' ><input type='checkBox' class='srchCovCheckBox' value='"+a[h]+"' name='"+a[h]+"'>"+a[h]+"</input></label>";b.style.height=20<e.length?f:18*(e.length+1)+"px";b.innerHTML=c+"<label for='Missing'><input type='checkBox' class='srchCovCheckBox' value='missing' name='missing'>Missing</input></label>";
b.querySelectorAll("label").forEach(k=>{k.onclick=g})};d.clearCheckBoxDropdown=function(a){document.getElementById(a).innerHTML=""};d.resetCheckBoxDropdown=function(a){a=document.getElementsByClassName(a);for(var b=0;b<a.length;b++)a[b].checked=!1};d.toggleCheckBox=function(a,b){"LABEL"===a.target.nodeName&&(b.children[0].checked=!b.children[0].checked)};d.showCheckBoxDropDown=function(a){a=document.getElementById(a);a.style.display="none"===a.style.display?"block":"none"};d.closeCheckBoxDropdown=
function(a,b){null!==document.getElementById(b).offsetParent&&document.getElementById(a).click()};d.keepElementInViewport=function(a){a=document.getElementById(a);if(null!==a){const b=a.getBoundingClientRect();b.bottom<window.innerHeight&&a.style.height&&(a.style.height="");b.bottom>window.innerHeight&&(a.style.height=window.innerHeight-b.top+"px");b.right>window.innerWidth&&(a.style.left=window.innerWidth-b.width+"px");0>b.top&&(a.style.top="0px");0>b.left&&(a.style.left="0px")}};d.embedThumbWidth=
"150px";d.embedThumbHeight="150px";d.defaultNgchmWidget="ngchmWidget-min.js";d.setNgchmWidget=function(a){d.defaultNgchmWidget=a};d.embedExpandableMap=function(a){if(void 0!==a.ngchm){void 0===a.divId&&(a.divId="NGCHM");void 0===a.thumbnail&&(a.thumbnail=a.ngchm.replace(/\.ngchm$/,".png"));void 0===a.thumbnailWidth&&(a.thumbnailWidth="150px");void 0===a.thumbnailHeight&&(a.thumbnailHeight=a.thumbnailWidth);void 0===a.ngchmWidget&&(a.ngchmWidget=d.defaultNgchmWidget);var b=void 0===a.displayWidth?
"100":a.displayWidth.substring(0,a.displayWidth.length-1),c=void 0===a.customJS?"":a.customJS,e=b;70>=b&&(e=70);d.embedThumbWidth=a.thumbnailHeight;var f=document.getElementById(a.divId),g=document.createElement("iframe");g.id=a.divId+"_iframe";g.scrolling="no";g.style="height:"+a.thumbnailHeight+"; width:100%; border-style:none; ";g.sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-downloads";g.className="ngchmThumbnail";f.appendChild(g);f=g.contentWindow.document;
f.open();f.write("<!DOCTYPE html><HTML><BODY style='margin:0px;width:100vw;height: 100vh;display: flex;flex-direction: column;'><div id='NGCHMEmbedWrapper' class='NGCHMEmbedWrapper' style='height: "+a.thumbnailHeight+"; width: "+a.thumbnailWidth+"'><img img id='NGCHMEmbedButton' src='"+a.thumbnail+"' alt='Show Heat Map' onclick='NgChm.API.showEmbed(this,\""+b+'","'+e+'","'+c+"\");' /><div class='NGCHMEmbedOverlay' onclick='NgChm.UTIL.showEmbed(this,\""+b+'","'+e+'","'+c+"\");' ><div id='NGCHMEmbedOverText'>Expand<br>Map</div></div></div><div id='NGCHMEmbedCollapse' style='display: none;width: 100px; height: 20px;'><div class='buttonGroup'><button id='NGCHMEmbedButton' onclick='NgChm.API.hideEmbed();'><span class='button'>Collapse Map</span></button></div></div><br/><div id='NGCHMEmbed' style='display: none; background-color: white; height: 100%; width: 98%; border: 2px solid gray; padding: 5px;'></div><script src='"+
a.ngchmWidget+"'>\x3c/script><script type='text/Javascript'>NgChm.API.embedCHM('"+a.ngchm+"');\x3c/script></BODY></HTML><br><br>");f.close()}};d.defaultNgchmWidget="ngchmWidget-min.js";d.b64toBlob=function(a){a=atob(a);let b=[];for(var c=0;c<a.length;c+=512){const f=a.slice(c,c+512);let g=Array(f.length);for(var e=0;e<f.length;e++)g[e]=f.charCodeAt(e);e=new Uint8Array(g);b.push(e)}return new Blob(b)};d.getClickType=function(a){var b=0;a=a||window.event;a.which||"undefined"===typeof a.button||(a.which=
a.button&1?1:a.button&2?3:a.button&4?2:0);switch(a.which){case 3:b=1}a.ctrlKey&&(b=1);return b};d.getCursorPosition=function(a){if(a.touches)if(0<a.touches.length){var b=a.target.getBoundingClientRect();var c=Math.round(a.targetTouches[0].pageX-b.left);a=Math.round(a.targetTouches[0].pageY-b.top)}else b=a.target.getBoundingClientRect(),c=Math.round(a.changedTouches[0].pageX-b.left),a=Math.round(a.changedTouches[0].pageY-b.top);else c=a.offsetX,a=a.offsetY;return{x:c,y:a}};d.hexToComplimentary=function(a){var b=
"rgb("+(a=a.replace("#","")).match(new RegExp("(.{"+a.length/3+"})","g")).map(function(m){return parseInt(a.length%2?m+m:m,16)}).join(",")+")";b=b.replace(/[^\d,]/g,"").split(",");var c=b[0],e=b[1],f=b[2];c/=255;e/=255;f/=255;var g=Math.max(c,e,f),h=Math.min(c,e,f);b=(g+h)/2;if(g==h)var k=h=0;else{var n=g-h;h=.5<b?n/(2-g-h):n/(g+h);g==c&&e>=f?k=1.0472*(e-f)/n:g==c&&e<f?k=1.0472*(e-f)/n+6.2832:g==e?k=1.0472*(f-c)/n+2.0944:g==f&&(k=1.0472*(c-e)/n+4.1888)}k=k/6.2832*360+45;360<k&&(k-=360);k/=360;0===
h?c=e=f=b:(f=function(m,p,l){0>l&&(l+=1);1<l&&--l;return l<1/6?m+6*(p-m)*l:.5>l?p:l<2/3?m+(p-m)*(2/3-l)*6:m},g=.5>b?b*(1+h):b+h-b*h,b=2*b-g,c=f(b,g,k+1/3),e=f(b,g,k),f=f(b,g,k-1/3));c=Math.round(255*c);e=Math.round(255*e);f=Math.round(255*f);return"#"+(16777216|f|e<<8|c<<16).toString(16).substring(1)};d.getContigRanges=function(a){const b=[];let c=a[0],e=a[0];if(0<a.length)for(let f=0;f<a.length;f++){let g=a[f];1<g-c?(b.push([e,c]),e=g,f===a.length-1&&b.push([g,g])):f===a.length-1&&b.push([e,g]);
c=g}return b};(function(){NgChm.exportToNS("NgChm.UTIL",{showSplashExample:function(){const c=document.getElementById("splashWaiting");if(c){var e=document.getElementById("splashExample");c.classList.add("hide");e.classList.remove("hide")}},showLoader:function(c){const e=document.getElementById("splash"),f=document.getElementById("loader");b+="<P>"+c;f.innerHTML=b;a&&(f.classList.replace("faded","fadeinslow"),e&&e.classList.replace("fadeinslow","fadeout"),a=!1)},hideLoader:function(c){document.getElementById("loader").classList.replace("fadeinslow",
"fadeout");c&&([...document.querySelectorAll("*[data-hide-on-load]")].forEach(e=>e.classList.add("hide")),d.containerElement.classList.replace("faded","fadein"),[...document.querySelectorAll("*[data-show-on-load]")].forEach(e=>e.classList.remove("hide")))}});var a=!0,b=""})();d.OutputClass=v;v.prototype.indent=function(){this.__indent++};v.prototype.unindent=function(){0<this.__indent&&this.__indent--};Object.setPrototypeOf(r.prototype,d.OutputClass.prototype);r.prototype.fmt=function(a){if(!a)return"";
let b="";0<this.__indent&&(b+=Array(2*this.__indent).fill("  ").join(""));return b+a};r.prototype.write=function(a){console.log(this.fmt(a))};r.prototype.error=function(a){console.error(this.fmt(a))};d.consoleOutput=new r;d.cmdRegistry=new Map;d.registerCommand=function(a,b,c){b=Array.isArray(b)?b:[b];c=Array.isArray(c)?c:[c];d.cmdRegistry.set(a,new y(a,b,c))};d.writeKnownCommands=function(a,b){a=b.output;a.write("Available commands:");a.write();a.indent();for(const [c]of d.cmdRegistry)a.write(c);
a.unindent()};d.getCommand=function(a){return d.cmdRegistry.has(a)?d.cmdRegistry.get(a):null};d.isCommand=function(a){return a instanceof y};(function(){String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return this.substr(b||0,a.length)===a});Element.prototype.remove||(Element.prototype.remove=function(){this.parentElement.removeChild(this)})})();(function(){var a=0,b=document.createElement("div");b.innerHTML="<div><p>a b c d e f g h i j k l m n o p q r s t u v w x y z</p></div>";
b.style.position="absolute";b.style.fontSize="1px";b.style.width="64px";document.body.appendChild(b);for(var c=b.offsetHeight,e=0,f=64,g,h=0;32>h&&5<=f;++h)g=(e+f)/2,b.style.fontSize=g+"px",b.offsetHeight===c?e=g:f=g;5<g&&(a=g,d.minLabelSize=Math.floor(g)-1);document.body.removeChild(b);return a})();(function(){let a=!1;"IE"===d.getBrowserType()&&(a=!0);5<d.minLabelSize&&(a=!0);const b=document.getElementById("messageOpen_btn");void 0!=b&&(b.style.display=a?"":"none")})();document.getElementById("srchCovSelectBox").onclick=
function(a){d.showCheckBoxDropDown("srchCovCheckBoxes")}})();
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,d){if(!d||null!=a){d=$jscomp.propertyToPolyfillSymbol[b];if(null==d)return a[b];d=a[d];return void 0!==d?d:a[b]}};
$jscomp.polyfill=function(a,b,d,e){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,d,e):$jscomp.polyfillUnisolated(a,b,d,e))};$jscomp.polyfillUnisolated=function(a,b,d,e){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];if(!(f in d))return;d=d[f]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,d,e){var f=a.split(".");a=1===f.length;e=f[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<f.length-1;h++){var n=f[h];if(!(n in e))return;e=e[n]}f=f[f.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?e[f]:null;b=b(d);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&(d=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+d+"$"+f),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill("Object.fromEntries",function(a){return a?a:function(b){var d={};if(!(Symbol.iterator in b))throw new TypeError(""+b+" is not iterable");b=b[Symbol.iterator].call(b);for(var e=b.next();!e.done;e=b.next()){e=e.value;if(Object(e)!==e)throw new TypeError("iterable for fromEntries should yield objects");d[e[0]]=e[1]}return d}},"es_2019","es3");
(function(){function a(f,h){for(let n=0;n<h.length;n++)f=f[h[n]];return f}function b(f,h){if(h.includes(".row_configuration.")){if(0<Object.keys(f.row_configuration.classifications).length)return!0}else if(0<Object.keys(f.col_configuration.classifications).length)return!0;return!1}function d(f,h){function n(m,c){for(var g in m)if(m.hasOwnProperty(g)){var k=c+"."+g;if("object"==typeof m[g])n(m[g],k);else if("undefined"===typeof h)p.set(k,m[g]);else if(-1<c.indexOf("row_configuration.classifications")){k=
h.row_configuration.classifications;for(let l in k)p.set(c+"."+l+"."+g,m[g])}else if(-1<c.indexOf("col_configuration.classifications")){k=h.col_configuration.classifications;for(let l in k)p.set(c+"."+l+"."+g,m[g])}else if(-1<c.indexOf("data_layer")){k=h.data_configuration.map_information.data_layer;for(let l in k){k=c+"."+l+"."+g;let q=m[g];"name"===g&&(q=q+" "+l);p.set(k,q)}}else p.set(k,m[g])}}const p=new Map;n(f,"");return p}NgChm.markFile();const e=NgChm.createNS("NgChm.CM");NgChm.importNS("NgChm.UTIL").getDebugFlag("compatibility");
e.version="2.26.0";e.versionCheckUrl="https://bioinformatics.mdanderson.org/versioncheck/NGCHM/";e.viewerAppUrl="https://bioinformatics.mdanderson.org/ngchm/ZipAppDownload";e.classOrderStr=".classifications_order";e.CompatibilityManager=function(f){let h=!1;var n=JSON.parse('{\n    "row_configuration": {\n    "classifications": {\n      "show": "Y",\n      "height": 15,\n      "bar_type": "color_plot",\n      "fg_color": "#000000",\n      "bg_color": "#FFFFFF",\n      "low_bound": "0",\n      "high_bound": "100"\n    },\n    "classifications_order": 1,\n    "organization": {\n      "agglomeration_method": "unknown",\n      "order_method": "unknown",\n      "distance_metric": "unknown"\n    },\n    "dendrogram": {\n      "show": "ALL",\n      "height": "100"\n    },\n    "label_display_length": "20",\n    "label_display_method": "END",\n    "top_items": [],\n    "top_items_cv": "--text-entry--"\n  },\n    "col_configuration": {\n    "classifications": {\n      "show": "Y",\n      "height": 15,\n      "bar_type": "color_plot",\n      "fg_color": "#000000",\n      "bg_color": "#FFFFFF",\n      "low_bound": "0",\n      "high_bound": "100"\n    },\n    "classifications_order": 1,\n    "organization": {\n      "agglomeration_method": "unknown",\n      "order_method": "unknown",\n      "distance_metric": "unknown"\n    },\n    "dendrogram": {\n      "show": "ALL",\n      "height": "100"\n    },\n    "label_display_length": "20",\n    "label_display_method": "END",\n    "top_items": [],\n    "top_items_cv": "--text-entry--"\n  },\n    "data_configuration": {\n      "map_information": {\n        "data_layer": {\n          "name": "Data Layer",\n          "grid_show": "Y",\n          "grid_color": "#FFFFFF",\n          "selection_color": "#00FF38",\n          "cuts_color": "#FFFFFF"\n        },\n        "name": "CHM Name",\n        "description": "Full length description of this heatmap",\n        "summary_width": "50",\n        "builder_version": "NA",\n        "summary_height": "100",\n        "detail_width": "50",\n        "detail_height": "100",\n        "read_only": "N",\n        "version_id": "1.0.0",\n        "map_cut_rows": "0",\n        "map_cut_cols": "0"\n      }\n    }\n  }'),
p=d(n,f);n=d(f);for(let [c,g]of p.entries())if((p=c.includes(e.classOrderStr))&&(c+=".0"),!n.has(c))if(p)b(f,c)&&(h=!0);else{var m=c.substring(1,c.lastIndexOf("."));p=c.substring(c.lastIndexOf(".")+1,c.length);m=m.split(".");"classifications"===m[1]&&(m[2]=m.slice(2).join("."));a(f,m)[p]=g;h=!0}(function(){let c=!1;const g=Object.entries(f.data_configuration.map_information.attributes).filter(l=>l[0].startsWith("!axistype")?(c=!0,!1):!0);for(let l in g)if(g[l][0].startsWith("!extraparam:"))c=!0,g[l][0]=
g[l][0].substr(12);else if(g[l][0].startsWith("!datasettype:")){var k=g[l][0].substr(13);if(k=/^([^:]*)-(row|column)/.exec(k)){c=!0;const q=k[1];g[l][0]=`datasettype-${k[2]}`;g[l][1]=`${q}:${g[l][1]}`}}c&&(h=!0,f.data_configuration.map_information.attributes=Object.fromEntries(g))})();return h};e.mapDataCompatibility=function(f){function h(c,g){if(!g.label.labelTypes){c=g.label.label_type;Array.isArray(c)||(c=[c]);c=c.map(l=>l.split(".bar.")).flat();c=c.map((l,q)=>({type:l,visible:0==q}));for(var k=
p(g.label.labels.map(n));c.length<k;)c.push({type:"none",visible:!1});g.label.labelTypes=c;delete g.label.label_type;m=!0}}function n(c){return c.split("|").length}function p(c){let g=c[0];for(const k of c.slice(1))k>g&&(g=k);return g}let m=!1;h("Column",f.col_data);h("Row",f.row_data);return m}})();
(function(){function l(a,b){this.props=Object.assign({},t,a);this.content=b||u.newElement("TABLE.ngchm-ui-table");this.props.id&&(this.content.id=this.props.id);this.indents=[];this.insertPosn=-1;a.id&&(this.content.id=a.id)}function n(a,b,c){const d=[];if(c.hasOwnProperty(a)){a=c[a];if(Array.isArray(a))for(c=0;c<a.length;c++)d.push(a[c]);else d.push(a);if(0<d.length)for(a=d[d.length-1];d.length<b;)d.push(a)}return d}function p(a,b,c){const d=[];c=c.hasOwnProperty("colSpan")?c.colSpan:1;if(Array.isArray(c)){c.length>
b&&console.error("Table.calcColumnSpans: colSpan has more columns than the row:",{colSpan:c,numColumnsInRow:b});for(var e=0;e<Math.min(c.length,b);e++)d.push(c[e]);for(;d.length<b;)d.push(1)}else for(e=0;e<b;e++)d.push(c);c=d.reduce((h,k)=>h+k,0);c>a?console.warn("Table.calcColumnSpans: assigned columns exceeds number of columns in table",{totalColumns:c,tableColumns:a,colSpans:d}):c<a&&(d[b-1]+=a-c);return d}NgChm.markFile();const q=NgChm.createNS("NgChm.UI.TABLE"),u=NgChm.importNS("NgChm.UTIL");
q.createTable=function(a={}){return new l(a)};const t={columns:2};q.Table=l;l.prototype.addBlankSpace=function(a){"undefined"===typeof a&&(a=1);const b=this.content.insertRow(this.insertPosn);-1!=this.insertPosn&&this.insertPosn++;const c=b.insertCell(0);c.style.lineHeight=(.3125*a).toFixed(3)+"em";c.setAttribute("colspan",this.props.columns);c.innerHTML="&nbsp;";return b};l.prototype.addIndent=function(a){"undefined"===typeof a&&(a=1);this.indents.push(a)};l.prototype.popIndent=function(){this.indents.pop()};
l.prototype.addRow=function(a,b={}){if("undefined"==typeof a)throw Error("Table.addRow: no contents provided.");a.length>this.props.columns&&console.warn("Table.addRow: adding row with more columns than the table",{contents:a,tableColumns:this.props.columns});b.hasOwnProperty("indent")&&console.error("Table.addRow: obsolete indent in options",{options:b});b=Object.assign({},{fontWeight:["bold","normal"],paddingRight:"0.5em"},b);const c=p(this.props.columns,a.length,b),d=this.content.insertRow(this.insertPosn);
-1!=this.insertPosn&&this.insertPosn++;d.className="chmTblRow";const e=n("align",a.length,b),h=n("fontWeight",a.length,b),k=n("paddingRight",a.length,b);b=n("underline",a.length,b);for(let f=0;f<a.length;f++){const g=d.insertCell(f);g.colSpan=c[f];h[f]&&(g.style.fontWeight=h[f]);e[f]&&(g.align=e[f]);k[f]&&(g.style.paddingRight=k[f]);b[f]&&(g.style.textDecoration="underline");for(const m of a.slice(f,f+1).flat())if(["string","number"].includes(typeof m)){const r=document.createElement("SPAN");r.innerHTML=
m;g.appendChild(r)}else g.appendChild(m)}0<this.indents.length&&d.firstChild&&(a=this.indents.reduce((f,g)=>f+g),d.firstChild.style.paddingLeft=(.28*a).toFixed(3)+"em");return d};l.prototype.setInsertPosn=function(a){this.insertPosn=a};l.prototype.addRowX=function(a,b={}){b=Object.assign({},{cellClasses:["label","value"],cellProperties:{}},b);p(this.props.columns,a.length,b);const c=this.content.insertRow();c.classList.add("chmTblRow");b.hasOwnProperty("rowClasses")&&(Array.isArray(b.rowClasses)?
b.rowClasses.forEach(e=>c.classList.add(e)):c.classList.add(b.rowClasses));1==c.classList.length&&c.classList.add("entry");const d=n("cellProperties",a.length,b);b=n("cellClasses",a.length,b);for(let e=0;e<a.length;e++){const h=c.insertCell(e);callClasses[e]&&(Array.isArray(b[e])?b[e].forEach(k=>h.classList.add(k)):h.classList.add(b[e]));if(d[e])for(let [k,f]of Object.entries(d[e]))if("object"!=typeof f)h[k]=f;else if("style"==k)for(let [g,m]of Object.entries(f))h.style[g]=m;else if("classList"==
k)f.forEach(g=>h.classList.add(g));else if("dataset"==k)for(let [g,m]of Object.entries(f))h.dataset[g]=m;else console.error("Table.addRowX: Unknown object in cellProperties: ",{i:e,key:k,value:f});["string","number"].includes(typeof a[e])||Array.isArray(a[e])?h.innerHTML=a[e]:a[e]&&h.appendChild(a[e])}}})();
(function(){function r(g){const k=(new Lexer(function(a,b){h&&console.log("Match no rule",{lexeme:a,other:b});return{type:"continuation",lexeme:a}})).addRule(/$/,function(a,b){h&&console.log('Match "/$/"',{lexeme:a,other:b});return{type:"EOF",lexeme:a}}).addRule(/"/,function(a,b){h&&console.log("Match double-quote",{lexeme:a,other:b});return{type:"double-quote",lexeme:a}}).addRule(/'/,function(a,b){h&&console.log("Match single quote",{lexeme:a,other:b});return{type:"single-quote",lexeme:a}}).addRule(/\\./,
function(a,b){h&&console.log("Match escaped char",{lexeme:a,other:b});return{type:"escaped",lexeme:a}}).addRule(/[^'"\\\s]+/,function(a,b){h&&console.log("Match word",{lexeme:a,other:b});return{type:"word",lexeme:a}}).addRule(/\s+/,function(a,b){h&&console.log('Match space "/[W]+/"',{lexeme:a,other:b});return{type:"space",lexeme:a}});k.setInput(g);return k}NgChm.markFile();const t=NgChm.createNS("NgChm.Parser"),m=NgChm.importNS("NgChm.UTIL"),n=m.getDebugFlag("parser"),h=m.getDebugFlag("lexer");t.parseCommand=
function(g){g=r(g);{const k=["single-quote","double-quote"],a=[];let b=!1,d="",c="normal";const l=[];for(let p=0;;p++){const q=g.lex();if(!q)break;const {type:e,lexeme:f}=q;if("EOF"==e)break;n&&console.log(`Token ${p}: ${e}: ${f}`);if("normal"==c)switch(e){case "word":d+=f;b=!0;break;case "continuation":l.push(c);c=e;break;case "single-quote":case "double-quote":b=!0;c=e;break;case "escaped":d+=f[1];b=!0;break;case "space":b&&(a.push(d),b=!1,d="")}else if(k.includes(c))e==c?c="normal":"escaped"==
e?d+=f[1]:"continuation"==e?(l.push(c),c="continuation"):d+=f;else if("continuation"==c&&"space"==e&&"\n"==f[0])c=l.pop(),"normal"==c?1<f.length&&(d&&a.push(d),d=""):d+=f.substr(1);else throw Error("Parser: Unexpected parse state: "+c);}if("normal"==c)b&&a.push(d),n&&console.log("Parsed command:",{cmd:a}),g=a;else{if(k.includes(c))throw`Parser: Unterminated ${c} string`;if("continuation"==c)throw"Parser: No continuation line";throw"Parser: Unexpected parse state: "+c;}}return g}})();
(function(){function n(a,c,b){c=c.output;c.error(`Unknown command: ${a.command}`);c.write();b(k.writeKnownCommands)}function p(a,c,b){function d(h,l){if(l<h.length){if("function"!=typeof h[l])throw Error("non-function in route");h[l](e,f,m=>{m?d(Array.isArray(m)?m:[m],0):d(h,l+1)})}}const e={};e.command=c[0];e.args=c.slice(1);const f={};f.output=b;d(Array.isArray(a)?a.flat():[a],0);return f.value}function t(a,c,b){c.output.write("");c.output.write("Append --help to a subcommand for detailed help.");
b()}function q(a){if(7!=a.length||!/^#[0-9A-Fa-f]*$/.test(a))throw`the format of color parameter "${a}" is not recognized`;return a}function r(a,c,b){0<a.args.length?(c=k.getCommand(a.args[0]),a.command=a.args[0],c?b(c.help):b(n)):(a=c.output,a.write(),a.write("Append the --help flag to a command for help specific to that command."),a.write(),b(k.writeKnownCommands))}NgChm.markFile();const g=NgChm.createNS("NgChm.EXEC"),k=NgChm.importNS("NgChm.UTIL"),u=NgChm.importNS("NgChm.Parser");g.runCommand=
function(a,c,b=!0){try{const d=u.parseCommand(a);return g.execCommand(d,c,b)}catch(d){d instanceof Error&&console.error(d),c.error(d)}};g.execCommand=function(a,c,b=!0){function d(f,h){h.write("Result:");for(const l of JSON.stringify(f,null,2).split("\n"))h.write(l)}if(0!=a.length){var e=k.getCommand(a[0]);if(e){if(k.isCommand(e))return a=p(e.route,a,c),b&&"undefined"!=typeof a&&d(a,c),a;console.warn("EXEC.execCommand: cmd is not a Command object",{args:a,cmd:e});if("--help"==a[a.length-1])e.showHelp(a.slice(0,
a.length-1),c);else return a=e(a,c),b&&"undefined"!=typeof a&&d(a,c),a}else p([n],a,c)}};g.doSubCommand=function(a,c,b,d,e){try{b.subcommand="";if(0==b.args.length)throw"subcommand expected";if("--help"==b.args[0])return e(c);if("--"==b.args[0].substr(0,2))throw`unexpected option ${b.args[0]}`;b.subcommand=b.args.shift();if(!a.has(b.subcommand))throw"unknown subcommand";return 0<b.args.length&&("--help"==b.args[0]||"--help"==b.args[b.args.length-1])?e(c):e(a.get(b.subcommand).route)}catch(f){return f instanceof
Error&&console.error(f),d.output.error(`${b.command} ${b.subcommand}: ${f}.`),e([].concat(c).concat(t))}};g.showOptions=function(a){return function(c,b,d){b.output.write();b.output.write("Options:");b.output.write();b.output.indent();d(a);b.output.unindent()}};g.genGetOptions=function(...a){const c=function(b){const d=new Map;for(const e of b)for(const [f,h]of e)d.set(f,h);return d}(a);return function(b,d,e){for(;0<b.args.length&&"--"==b.args[0].substr(0,2)&&"--help"!=b.args[0];){d=b.args.shift();
if("--"==d)break;if(!c.has(d))throw`option ${d} is not expected here`;const f=c.get(d);if(b.args.length<f.args)throw`option ${d} requires ${f.args} parameter${1<f.args?"s":""}`;b[f.field]=0==f.args?!0:1==f.args?b.args.shift():b.args.splice(0,f.args)}e()}};g.genSubCommandHelp=function(a){return function(c,b,d){b=b.output;b.write("");const e=a.get(c.subcommand);if(e){b.write(`Usage: ${c.command} ${c.subcommand} ${e.synopsis}`);b.write();if(e.helpRoute)return d(e.helpRoute);console.log(`Old style help still on ${c.command} ${c.subcommand}`);
b.write(e.help)}else{b.write("Usage:");b.indent();b.write("");for(const [f,h]of a)b.write(`${c.command} ${f} ${h.synopsis}`);b.unindent()}d()}};g.noMoreParams=function(a,c,b){if(0!=a.args.length)throw"excess parameter(s)";b()};const v=["row","column"];g.reqAxis=function(a,c,b){if(0==a.args.length)throw"missing axis parameter";a.axis=g.mustMatch(a.args.shift(),v);b()};g.mustMatch=function(a,c){const b=c.map(d=>d.substr(0,a.length));if(1!=b.filter(d=>d==a).length)throw`parameter '${a}' is not a unique substring of: ${c.join(", ")}`;
return c[b.indexOf(a)]};g.reqColor=function(a,c,b){if(0==a.args.length)throw"missing color parameter";a.color=q(a.args.shift());b()};g.reqColorArray=function(a,c,b){if(0==a.args.length)throw"missing color parameters";for(a.colors=[];0<a.args.length;)a.colors.push(q(a.args.shift()));b()};const w=["discrete","continuous"];g.reqDataType=function(a,c,b){if(0==a.args.length)throw"missing data type parameter";a.datatype=g.mustMatch(a.args.shift(),w);b()};g.genRequired=function(a,c=!1){return function(b,
d,e){if(0==b.args.length)throw`missing ${a} parameter`;b[a]=b.args.shift();if(!c&&0==b[a].length)throw`${a} parameter cannot be empty`;e()}};g.helpDataType=function(a,c,b){c.output.write();c.output.write("Datatype must be discrete or continuous.");b()};g.helpColorValue=function(a,c,b){c.output.write();c.output.write("Colors must be hex color strings. e.g. #ff0000.");b()};k.registerCommand("help",r,r)})();
(function(){function g(a){this.name=a.name;this.colors=a.colors;this.missing=a.missing||"#000000";this.interpolation=a.interpolation||"cycle"}function v(a,b,c,f,e){++t;const h="linear-gradient(to right, "+c.colors.join(", ")+")",l=function(m,w,x,y){return function(){b(m,w,x,y)}}(a,c,f,e);a=k.newElement("DIV.presetPalette",{id:"preset"+t,style:{background:h}},null,function(m){m.onclick=l;return m});c=k.newElement("DIV.presetPaletteMissingColor",{style:{background:c.missing}},null,function(m){m.onclick=
l;return m});return k.newElement("DIV",{style:{display:"flex"}},[a,c])}function p(a,b,c){b.output.write();b.output.write("Name is the name of a color preset.");c()}function r(a,b,c){const f=q.get(a),e=f.map(h=>h.name).indexOf(b);return 0>e?(c.error(`${k.toTitleCase(a)} preset ${b} does not exist.`),null):f[e]}function z(a,b,c,f){const e=q.get(a),h=e.map(l=>l.name).indexOf(b);0>h?(c=new g({name:b,colors:c,missing:"#000000"}),e.push(c),f.write(`Added ${a} preset '${b}'`)):(e[h].colors=c,f.write(`Replaced colors in ${a} preset '${b}'`))}
function A(a,b,c){const f=q.get(a),e=f.map(h=>h.name).indexOf(b);if(0>e)throw`Unable to remove ${a} preset ${b}: no such preset`;f.splice(e,e+1);c.write(`Removed ${a} preset '${b}'`)}NgChm.markFile();NgChm.createNS("NgChm.PALETTES").addPredefinedPalettes=function(a,b,c,f,e){a.addRow(["Choose a pre-defined color palette:"],{underline:!0});a.addBlankSpace();a.addIndent();const h=[],l=[];for(const m of q.get(e))h.push(v(b,c,m,f,e)),l.push(`&nbsp;<b>${m.name}</b>`),3==l.length&&(a.addRow(h.slice()),a.addRow(l.slice(),
{fontWeight:"bold"}),h.length=0,l.length=0);0<l.length&&(a.addRow(h.slice()),a.addRow(l.slice(),{fontWeight:"bold"}));a.popIndent()};const k=NgChm.importNS("NgChm.UTIL"),d=NgChm.importNS("NgChm.EXEC"),q=new Map;q.set("continuous",[new g({name:"Blue Red",colors:["#0000FF","#FFFFFF","#FF0000"],missing:"#000000"}),new g({name:"Green Red",colors:["#00FF00","#000000","#FF0000"],missing:"#ffffff"}),new g({name:"Rainbow",colors:"#FF0000 #FF8000 #FFFF00 #00FF00 #0000FF #FF00FF".split(" "),missing:"#000000"}),
new g({name:"Greyscale",colors:["#FFFFFF","#000000"],missing:"#FF0000"}),new g({name:"Heat",colors:[[0,100,100],[60,100,100],[60,0,100]].map(a=>k.hsvToRgb.apply(null,a)),missing:"#000000"}),new g({name:"Heat 2",colors:[[0,100,0],[0,100,100],[60,100,100],[60,0,100]].map(a=>k.hsvToRgb.apply(null,a)),missing:"#00ffff"})]);q.set("discrete",[new g({name:"Palette 1",colors:"#1f77b4 #ff7f0e #2ca02c #d62728 #9467bd #8c564b #e377c2 #7f7f7f #bcbd22 #17becf".split(" "),missing:"#ffffff"}),new g({name:"Palette 2",
colors:"#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5".split(" "),missing:"#ffffff"}),new g({name:"Palette 3",colors:"#393b79 #637939 #8c6d31 #843c39 #7b4173 #5254a3 #8ca252 #bd9e39 #ad494a #a55194 #6b6ecf #b5cf6b #e7ba52 #d6616b #ce6dbd #9c9ede #cedb9c #e7cb94 #e7969c #de9ed6".split(" "),missing:"#ffffff"}),new g({name:"Greyscale",colors:["#ffffff","#555555"],missing:"#ff0000",interpolation:"ramp"}),
new g({name:"Cyan Yellow",colors:Array(121).fill(0).map((a,b)=>k.hsvToRgb(180-b,80,80)),missing:"#000000",interpolation:"spread"}),new g({name:"Green Magenta",colors:[[100,100,100],[200,10,100],[300,100,100]].map(a=>k.hsvToRgb.apply(null,a)),missing:"#000000",interpolation:"ramp"})]);g.prototype.getColorArray=function(a){const b=[];if("spread"==this.interpolation)for(var c of k.pick(a,this.colors.length))b.push(this.colors[c]);else if("ramp"==this.interpolation)for(c=0;c<a;c++){const f=c/(a-1)*(this.colors.length-
1),e=Math.floor(f);e==this.colors.length-1?b.push(this.colors[e]):b.push(k.blendTwoColors(this.colors[e],this.colors[e+1],f-e))}else for(c=0;c<a;c++)b.push(this.colors[c%this.colors.length]);return b};var t=0;const n=new Map;n.set("list",{synopsis:"",helpRoute:[function(a,b,c){b.output.write("list the available presets");c()}],route:[d.noMoreParams,function(a,b){a=b.output;for(const c of["discrete","continuous"]){a.write(`${k.toTitleCase(c)} presets:`);a.write();a.indent();for(const f of q.get(c))a.write(`${f.name}: ${f.colors.length} colors.`);
a.unindent();a.write()}}]});n.set("set-colors",{synopsis:"datatype name color1 color2...",helpRoute:[function(a,b,c){b.output.write("set the colors on a new or existing preset");c()},p,d.helpDataType,d.helpColorValue],route:[d.reqDataType,d.genRequired("name"),d.reqColorArray,function(a,b){if(2>a.colors.length)throw`${a.command} ${a.subcommand}: Not enough parameters. At least two colors are required.`;return z(a.datatype,a.name,a.colors,b.output)}]});n.set("set-missing",{synopsis:"datatype name color",
helpRoute:[function(a,b,c){b.output.write("set the missing color on an existing preset");c()},p,d.helpDataType,d.helpColorValue],route:[d.reqDataType,d.genRequired("name"),d.reqColor,d.noMoreParams,function(a,b){const c=r(a.datatype,a.name,b.output);c&&(c.missing=a.color,b.output.write(`Replaced missing color in ${a.datatype} preset '${a.name}'`))}]});n.set("show",{synopsis:"datatype name",helpRoute:[function(a,b,c){b.output.write("show an existing preset");c()},p,d.helpDataType],route:[d.reqDataType,
d.genRequired("name"),d.noMoreParams,function(a,b){b=b.output;if(a=r(a.datatype,a.name,b))b.write(`${a.name} (${a.colors.length} colors):`),b.write(`${a.colors.join(", ")}`),b.write(`Missing: ${a.missing}`)}]});n.set("remove",{synopsis:"datatype name",helpRoute:[function(a,b,c){b.output.write("remove an existing preset");c()},p,d.helpDataType],route:[d.reqDataType,d.genRequired("name"),d.noMoreParams,function(a,b){return A(a.datatype,a.name,b.output)}]});n.set("get-colors",{synopsis:"datatype name",
helpRoute:[function(a,b,c){b.output.write("get the colors of an existing preset");c()},p,d.helpDataType],route:[d.reqDataType,d.genRequired("name"),d.noMoreParams,function(a,b){a=r(a.datatype,a.name,b.output);b.value=a?a.colors:null}]});n.set("get-missing",{synopsis:"datatype name",helpRoute:[function(a,b,c){b.output.write("get the missing color of an existing preset");c()},p,d.helpDataType],route:[d.reqDataType,d.genRequired("name"),d.noMoreParams,function(a,b){a=r(a.datatype,a.name,b.output);b.value=
a?a.missing:null}]});const u=[d.genSubCommandHelp(n),p,d.helpDataType,d.helpColorValue];k.registerCommand("preset",function(a,b,c){d.doSubCommand(n,u,a,b,c)},u)})();
(function(){function m(){return"flickUp"===f.dataset.state}function g(a){var b=f.dataset.state;let c=("flickUp"===b?d.value:e.value)||"dl1",h=!1;"toggle"===a?(a="flickUp"===b?"flick2":"flick1",b=n(a),c!==b&&(c=b,h=!0)):"flick1"===a&&"flickUp"===b?h=!0:"flick2"===a&&"flickDown"===b?h=!0:c=("flick1"===a?d.value:e.value)||"dl1";return{flickElement:a,layer:c,redrawRequired:h}}function n(a){f.dataset.state="flick1"===a?"flickUp":"flickDown";return("flick1"===a?d.value:e.value)||"dl1"}NgChm.markFile();
NgChm.createNS("NgChm.FLICK",{enableFlicks:function(a,b,c){d.innerHTML=b;e.innerHTML=b;f.dataset.state="flickUp"==c.flick_btn_state||"flickDown"==c.flick_btn_state?c.flick_btn_state:"flickUp";d.value=a.includes(c.flick1)?c.flick1:a[0];a.includes(c.flick2)?e.value=c.flick2:e.value=2>a.length||a[1]==d.value?a[0]:a[1];k.style.display="";return m()?d.value:e.value},disableFlicks:function(){k.style.display="none"},flickIsOn:function(){return""===k.style.display},isFlickUp:m,getFlickState:function(){const a=
{element:"flick1",layer:d.value||"dl1"};if("none"==k.style.display)return[a];const b={element:"flick2",layer:e.value};return"flickUp"===f.dataset.state?[a,b]:[b,a]},setFlickState:n,toggleFlickState:g,setFlickHandler:function(a){document.getElementById("flick_btn").onclick=function(b){a(g("toggle"))};document.getElementById("flick1").onchange=function(b){a(g("flick1"))};document.getElementById("flick2").onchange=function(b){a(g("flick2"))}},getFlickSaveState:function(){return{flick_btn_state:f.dataset.state,
flick1:d.value,flick2:e.value}}});const k=document.getElementById("layer_control"),l=document.getElementById("layers_open_close");document.getElementById("flick_btn");const f=document.getElementById("flickViews"),d=document.getElementById("flick1"),e=document.getElementById("flick2");l.onclick=function(a){"closed"==l.dataset.state?(d.selectedIndex===e.selectedIndex&&(e.selectedIndex=0===d.selectedIndex?1:0),f.style.display="",l.dataset.state="open"):(f.style.display="none",l.dataset.state="closed")}})();
(function(){function r(a,c,d,e,f){"function"==typeof e&&(f=e,e="missing - deprecated");const g=a.querySelector(".msgBoxButtons"),h=document.createElement("button");h.id="msgBoxBtn_"+c;"object"!=typeof d&&(d={type:"image",src:d});"image"==d.type?(c=document.createElement("img"),c.src=d.src,c.alt=d.alt||e,h.appendChild(c)):(e=k.newElement("span.button"),e.innerText=d.text,c=k.newElement("span.spanbuttonwrapper"),c.appendChild(e),h.appendChild(c));d.default&&h.classList.add("default");d.disabled?(h.disabled=
!0,h.dataset.tooltip=(d.tooltip?d.tooltip+". ":"")+"Disabled because "+(d.disabledReason||"of unspecified reason")):d.tooltip&&(h.dataset.tooltip=d.tooltip+".");h.onclick=void 0==f?()=>{a==document.getElementById("msgBox")?b.messageBoxCancel():document.body.removeChild(a)}:function(l){d.disableOnClick&&(h.disabled=!0);f(h)};g.appendChild(h)}NgChm.markFile();const b=NgChm.createNS("NgChm.UHM"),k=NgChm.importNS("NgChm.UTIL");b.postMapDetails=!1;b.postMapToWhom=null;b.myNonce="N";var n=null,p=null;(function(){document.getElementById("messageOpen_btn").onclick=
()=>{b.displayStartupWarnings()}})();(function(){function a(c){let d=c;for(;d;){if("button"==d.tagName.toLowerCase()||d.dataset.hasOwnProperty("tooltip")||d.dataset.hasOwnProperty("title"))return d;d=d.parentElement}return c}document.addEventListener("mouseover",function(c){c=a(c.target);c.dataset.hovering="";if(c.dataset.tooltip){let d=c.dataset.tooltip;c.disabled&&c.dataset.disabledReason&&(d+=" "+c.dataset.disabledReason);b.hlp(c,d,140,0)}},{passive:!0});document.addEventListener("mouseout",function(c){delete a(c.target).dataset.hovering},
{passive:!0});document.addEventListener("click",function(c){b.hlpC();b.closeMenu();[...document.getElementsByClassName("remove-on-click")].forEach(d=>{d.remove()})},{passive:!0})})();b.processMessage=function(a){""===b.myNonce&&(b.myNonce=k.getURLParameter("nonce"));""!==b.myNonce&&a.data&&a.data.nonce===b.myNonce&&("ShowMapDetail"===a.data.override&&(b.postMapDetails=!0,b.postMapToWhom=a.origin),null!=a.data.ngchm_id&&(b.postID=a.data.ngchm_id))};window.addEventListener("message",b.processMessage,
!1);b.formatMapDetails=function(a,c){a.insertRow().innerHTML=b.formatBlankRow();b.setTableRow(a,["<u>Data Details</u>","&nbsp;"],2);b.setTableRow(a,["&nbsp;Value:",c.value]);b.setTableRow(a,["&nbsp;Row:",c.rowLabel]);b.setTableRow(a,["&nbsp;Column:",c.colLabel]);0<c.rowCovariates.length&&(a.insertRow().innerHTML=b.formatBlankRow(),b.setTableRow(a,["&nbsp;<u>Row Covariates</u>","&nbsp;"],2),c.rowCovariates.forEach(d=>{const e=20<d.name.length?d.name.substring(0,20)+"...":d.name;b.setTableRow(a,["&nbsp;&nbsp;&nbsp;"+
e+":</u>",d.value])}));0<c.colCovariates.length&&(a.insertRow().innerHTML=b.formatBlankRow(),b.setTableRow(a,["&nbsp;<u>Column Covariates</u>","&nbsp;"],2),c.colCovariates.forEach(d=>{const e=20<d.name.length?d.name.substring(0,20)+"...":d.name;b.setTableRow(a,["&nbsp;&nbsp;&nbsp;"+e+":</u>",d.value])}))};b.pasteHelpContents=function(){var a=document.getElementById("helpTable");window.open("","","width=500,height=330,resizable=1").document.write(a.innerText.replace(/(\r\n|\n|\r)/gm,"<br>"))};b.hlp=
function(a,c,d,e,f=500){a!=p&&(b.hlpC(),p=a,n=setTimeout(function(){const g=document.querySelector("body");if(g&&""==a.dataset.hovering){var h=b.getElemPosition(a),l=k.newElement("span.title",{},[k.newTxt(a.dataset.title||"")]),m=k.newElement("span.intro",{},[a.dataset.intro||c]);l=k.newElement("div#bubbleHelp",{},[l,m]);void 0!==e?(m=h.left-d,0>m&&(m=0),l.style.left=m+"px"):l.style.left=h.left+"px";l.style.top=h.top+40+"px";l.innerHTML="<b><font size='2' color='#0843c1'>"+c+"</font></b>";l.style.display=
"inherit";g.appendChild(l);n=null;setTimeout(()=>{p==a&&(p=null,b.hlpC())},5E3)}},f))};b.getElemPosition=function(a){for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}};b.hlpC=function(){null!==n&&(clearTimeout(n),p=n=null);let a=document.getElementById("bubbleHelp");null===a&&(a=document.getElementById("helptext"));a&&a.remove()};b.setTableRow=function(a,c,d,e){a=a.insertRow();a.className="chmTblRow";
for(var f=0;f<c.length;f++){var g=a.insertCell(f);"undefined"!=typeof d&&(g.colSpan=d);0===f&&(g.style.fontWeight="bold");["string","number"].includes(typeof c[f])||Array.isArray(c[f])?g.innerHTML=c[f]:c[f]&&g.appendChild(c[f]);"undefined"!=typeof e&&(g.align=e)}return a};b.setTableRowX=function(a,c,d,e){d=d||[];e=e||Array(c.length);const f=a.insertRow();f.classList.add("chmTblRow");d.forEach(g=>{f.classList.add(g)});1==f.classList.length&&f.classList.add("entry");for(a=0;a<c.length;a++){const g=
f.insertCell(a);for(let [h,l]of Object.entries(e[a]||{}))if("object"!=typeof l)g[h]=l;else if("style"==h)for(let [m,q]of Object.entries(l))g.style[m]=q;else if("classList"==h)l.forEach(m=>g.classList.add(m));else if("dataset"==h)for(let [m,q]of Object.entries(l))g.dataset[m]=q;else console.error("Unknown object in tdProps: "+h);0==g.classList.length&&g.classList.add(0==a?"label":"value");["string","number"].includes(typeof c[a])||Array.isArray(c[a])?g.innerHTML=c[a]:c[a]&&g.appendChild(c[a])}};b.formatBlankRow=
function(){return"<td style='line-height:4px;' colspan=2>&nbsp;</td>"};b.addBlankRow=function(a,c){a.insertRow().innerHTML=b.formatBlankRow();if("undefined"!==typeof c)for(var d=1;d<c;d++)a.insertRow().innerHTML=b.formatBlankRow()};b.hamburgerLinkMissing=function(){b.initMessageBox();b.setMessageBoxHeader("NG-CHM Menu Link Error");b.setMessageBoxText("<br>No destination has been defined for the menu link.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);
b.displayMessageBox()};b.systemMessage=function(a,c){b.initMessageBox();b.setMessageBoxHeader(a);b.setMessageBoxText("<br>"+c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.noWebGlContext=function(a){b.initMessageBox();b.setMessageBoxHeader("ERROR: WebGL Initialization Failed");a?b.setMessageBoxText("<br>WebGL is available but is not enabled on your machine.  The NG-CHM Application requires the WebGL Javascript API in order to render images of Next Generation Clustered Heat Maps.<br><br>Instructions for enabling WebGL, based on browser type, can be found via a web search."):
b.setMessageBoxText("<br>No WebGL context is available.  The NG-CHM Application requires the WebGL Javascript API in order to render images of Next Generation Clustered Heat Maps. Most web browsers and graphics processors support WebGL.<br><br>Please ensure that the browser that you are using and your computer's processor are WebGL compatible.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.mapNotFound=function(a){k.hideLoader(!1);
b.initMessageBox();b.setMessageBoxHeader("Requested Heat Map Not Found");b.setMessageBoxText("<br>The Heat Map ("+a+") that you requested cannot be found OR connectivity to the Heat Map repository has been interrupted.<br><br>Please check the Heat Map name and try again.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.mapLoadError=function(a,c){k.hideLoader(!1);b.initMessageBox();b.setMessageBoxHeader("Requested Heat Map Not Loaded");
b.setMessageBoxText("<br>The Heat Map ("+a+") that you selected cannot be loaded.<br><br>Reason: "+c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.linkoutError=function(a){b.initMessageBox();b.setMessageBoxHeader("Heat Map Linkout");b.setMessageBoxText(a);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.invalidFileFormat=function(){b.initMessageBox();b.setMessageBoxHeader("Invalid File Format");
b.setMessageBoxText("<br>The file chosen is not an NG-CHM file.<br><br>Please select a .ngchm file and try again.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.initMessageBox=function(){b.hideMsgBoxProgressBar();const a=document.getElementById("msgBox");for(;0<a.classList.length;)a.classList.remove(a.classList[0]);a.style.display="none";a.style.width="";const c=a.querySelector(".msgBoxButtons");for(;c.firstChild;)c.removeChild(c.firstChild);
document.getElementById("messageOpen_btn").style.display="none";return a};b.messageBoxIsVisible=function(){const a=document.getElementById("msgBox");return a&&"none"!=a.style.display};b.setMessageBoxHeader=function(a){var c=document.getElementById("msgBoxHdr");c.innerHTML="<SPAN>"+a+"</SPAN>";c.querySelector(".closeX")&&c.querySelector(".closeX").remove();c.appendChild(b.createCloseX(b.messageBoxCancel))};b.getMessageTextBox=function(){return document.getElementById("msgBoxTxt")};b.setMessageBoxText=
function(a){document.getElementById("msgBoxTxt").innerHTML=a};b.displayMessageBox=function(){let a=document.getElementById("msgBox");a.style.display="";a.style.left=(window.innerWidth-a.offsetWidth)/2+"px";let c=document.getElementById("mdaServiceHeader");a.style.top=c.offsetTop+15+"px"};b.setMessageBoxButton=function(a,c,d,e){const f=document.getElementById("msgBox");r(f,a,c,d,e)};b.showMsgBoxProgressBar=function(){document.getElementById("msgBoxProgressDiv").style.display="";document.getElementById("msgBoxProgressBar").value=
0};b.hideMsgBoxProgressBar=function(){document.getElementById("msgBoxProgressDiv").style.display="none"};b.isProgressBarVisible=function(){return""==document.getElementById("msgBoxProgressDiv").style.display};b.msgBoxProgressMeter=function(a){document.getElementById("msgBoxProgressBar").value=a;return"true"!=document.getElementById("msgBoxProgressBar").dataset.cancelled};b.cancelOperation=function(){document.getElementById("msgBoxProgressBar").dataset.cancelled="true";document.getElementById("msgBoxProgressDiv").style.opacity=
.5};b.messageBoxCancel=function(){b.initMessageBox()};b.newMessageBox=function(a,c){a="msgBox-for-"+a;const d=document.getElementById(a);if(d)return d;c=document.querySelector("template#"+(c||"msgBoxTemplate")).content.querySelector("div").cloneNode(!0);c.classList.add("hide");c.id=a;document.body.appendChild(c);k.dragElement(c);return c};b.setNewMessageBoxHeader=function(a,c){const d=a.querySelector(".msgBoxHdr");d.innerHTML="<SPAN>"+c+"</SPAN>";d.querySelector(".closeX")&&d.querySelector(".closeX").remove();
d.appendChild(b.createCloseX(()=>{b.closeNewMessageBox(a)}))};b.getNewMessageTextBox=function(a){return a.querySelector(".msgBoxTxt")};b.setNewMessageBoxButton=function(a,c,d,e){e||(e=()=>{b.closeNewMessageBox(a)});r(a,c,d,e)};b.displayNewMessageBox=function(a){a.classList.remove("hide")};b.closeNewMessageBox=function(a){document.body.removeChild(a)};b.closeMenu=function(){const a=document.getElementById("barMenu_btn");null===a||a.dataset.hasOwnProperty("hovering")||(document.getElementById("burgerMenuPanel").style.display=
"none")};b.displayStartupWarnings=function(){b.hlpC();b.initMessageBox();var a="NG-CHM Startup Warning",c="",d=!1,e=1;"IE"===k.getBrowserType()?c="<br><b>Unsupported Browser Warning:</b> Your current browser is Internet Explorer. The NG-CHM application is optimized for use with the Google Chrome and Mozilla Firefox browsers.  While you may view maps in IE, the performance of the application cannot be guaranteed.<br><br>You may wish to switch to one of these supported browsers.":(11<k.minLabelSize&&
(d&&(c+="<br>"),c+="<br><b>Minimum Font Warning:</b> Current browser settings include a minimum font size setting that is too large. This will block the display of row, column, and covariate bar labels in the NG-CHM application. You may wish to turn off or adjust this setting in your browser.",d=!0,e++),5<k.minLabelSize&&(d&&(c+="<br>"),c+="<br><b>Minimum Font Warning:</b> Current browser settings include a minimum font size setting. This may interfere with the display of row, column, and covariate bar labels in the NG-CHM application. You may wish to turn off or adjust this setting in your browser.",
e++));2<e&&(a+="s");b.setMessageBoxHeader(a);b.setMessageBoxText(c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.createCloseX=function(a){const c=k.newSvgButton("icon-big-x.red");c.onclick=a;return k.newElement("SPAN.closeX",{},[c])}})();
(function(){NgChm.markFile();const a=NgChm.createNS("NgChm.MAPREP");a.maxValues=2147483647;a.minValues=-2147483647;a.THUMBNAIL_LEVEL="tn";a.SUMMARY_LEVEL="s";a.RIBBON_VERT_LEVEL="rv";a.RIBBON_HOR_LEVEL="rh";a.DETAIL_LEVEL="d";a.isRow=function(b){return b&&"row"===b.toLowerCase()}})();
(function(){function m(f){return(f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16),a:255}:null}NgChm.markFile();const p=NgChm.createNS("NgChm.CMM"),u=NgChm.importNS("NgChm.MAPREP");p.ColorMap=function(f,h){function g(a,b){for(var c={},e=0;e<v;){if(b[e]<=a&&a<b[e+1]){c.upper=e+1;c.lower=e;break}e++}return c}function n(a,b,c){a=(a-c[b])/(c[b+1]-c[b]);c=k[b];b=k[b+1];const e={};e.r=Math.round(c.r*(1-a)+b.r*a);e.g=Math.round(c.g*(1-a)+
b.g*a);e.b=Math.round(c.b*(1-a)+b.b*a);e.a=255;return e}function l(a){const {r:b,g:c,b:e}=a;return"#"+q(b)+q(c)+q(e)}function q(a){a=a.toString(16);return 1==a.length?"0"+a:a}this.heatMap=f;var w=h.type;var d="quantile"==w?h.linearEquiv:h.thresholds;var v=d.length,r=h.colors,x=h.missing,k=[],t;if(void 0!=h.rgbaColors)k=h.rgbaColors;else for(f=0;f<v;f++)k[f]=m(r[f]);void 0!=h.rgbaMissingColor?rgbaMissingColors=h.rgbaMissingColor:t=m(x);this.getThresholds=function(){return d};this.setThresholds=function(a){d=
a};this.getContinuousThresholdKeys=function(){const a=[],b=d[0],c=this.getContinuousThresholdKeySize();a.push(b);for(let e=1;8>=e;e++)a.push(b+c*e);a.push(d[d.length-1]);return a};this.getContinuousThresholdKeySize=function(){return(d[d.length-1]-d[0])/9};this.getColors=function(){return r};this.setColors=function(a){r=a};this.getType=function(){return w};this.getMissingColor=function(){return x};this.setMissingColor=function(a){x=a};class z{constructor(a,b){this.minBreak=b[0];this.maxIdx=b.length-
1;this.maxBreak=b[this.maxIdx];this.thresholds=b;this.cutsColor=a.getCutsColor()}getColor(a){return"Missing"===a||isNaN(a)?t:this.contColor(+a)}contColor(a){if(a<=this.minBreak)return a<=u.minValues?this.cutsColor:k[0];if(a>=this.maxBreak)return a>=u.maxValues?t:k[this.maxIdx];let b;if(a<this.thresholds[1])b=0;else if(a<this.thresholds[2])b=1;else for(b=2;a>=this.thresholds[b+1];)b++;return n(a,b,this.thresholds)}}this.getContColorMap=function(){return new z(this,d)};this.getCutsColor=function(){const a=
this.heatMap.getDataLayers()[this.heatMap.getCurrentDL()];return"undefined"!==typeof a.cuts_color?m(a.cuts_color):{r:255,g:255,b:255,a:255}};this.getColor=function(a){if(a>=u.maxValues||"Missing"==a||isNaN(a))a=t;else if(a<=u.minValues)a=this.getCutsColor();else if(a<=d[0])a=k[0];else if(a>=d[v-1])a=k[v-1];else{const b=g(a,d);a=n(a,b.lower,d)}return a};this.getClassificationColor=function(a){if("!CUT!"==a)return{r:255,g:255,b:255,a:255};if("All Black"===a)return{r:0,g:0,b:0,a:255};if("discrete"==
w){for(var b=0;b<d.length;b++)if(a==d[b])return a=k[b];return t}return a=isNaN(a)?t:this.getColor(a)};this.addBreakpoint=function(a,b){var c=g(a,d);d.splice(c.lower,0,a);r.splice(c.lower,0,b);k.splice(c.lower,0,m(b))};this.changeBreakpoint=function(a,b){var c=g(a,d);d.splice(c.lower,1,a);r.splice(c.lower,1,b);k.splice(c.lower,1,m(b))};this.removeBreakpoint=function(a){a=g(a,d);d.splice(a.lower,1);r.splice(a.lower,1);k.splice(a.lower,1)};this.getColorLuminance=function(a){return(a=(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?
{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null)?.2126*a.r+.7152*a.g+.0722*a.b:null};this.isColorDark=function(a){return a?60>.2126*a.r+.7152*a.g+.0722*a.b?!1:!0:!1};this.getRgbToHex=function(a){var b=a.g,c=a.b;return"#"+q(a.r)+q(b)+q(c)};p.blendHexColors=function(a,b,c){a=m(a);b=m(b);return l({r:a.r*c+b.r*(1-c)|0,g:a.g*c+b.g*(1-c)|0,b:a.b*c+b.b*(1-c)|0,a:a.a*c+b.a*(1-c)|0})};p.darkenHexColorIfNeeded=function(a){const {r:b,g:c,b:e}=m(a),y=Math.min(b,c,e);if(240>=y)return a;a=240/
y;return l({r:b*a|0,g:c*a|0,b:e*a|0})}};p.ColorMapManager=function(f){this.heatMap=f;f=f.mapConfig;const h=[f.data_configuration.map_information.data_layer,f.row_configuration.classifications,f.col_configuration.classifications];this.getColorMap=function(g,n){return new p.ColorMap(this.heatMap,h["data"===g?0:"row"===g?1:2][n].color_map)};this.getColorMapJSON=function(g,n){return JSON.stringify(h["data"===g?0:"row"===g?1:2][n].color_map)};this.setColorMap=function(g,n,l){g="data"===g?0:"row"===g?1:
2;l=l instanceof p.ColorMap?{type:l.getType(),colors:l.getColors(),thresholds:l.getThresholds(),missing:l.getMissingColor()}:l;Object.assign(h[g][n].color_map,l)}};p.hexToRgba=m})();
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(k){var n=0;return function(){return n<k.length?{done:!1,value:k[n++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,n,p){if(k==Array.prototype||k==Object.prototype)return k;k[n]=p.value;return k};$jscomp.getGlobal=function(k){k=["object"==typeof globalThis&&globalThis,k,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var n=0;n<k.length;++n){var p=k[n];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(k,n,p){if(!p||null!=k){p=$jscomp.propertyToPolyfillSymbol[n];if(null==p)return k[n];p=k[p];return void 0!==p?p:k[n]}};
$jscomp.polyfill=function(k,n,p,l){n&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(k,n,p,l):$jscomp.polyfillUnisolated(k,n,p,l))};$jscomp.polyfillUnisolated=function(k,n,p,l){p=$jscomp.global;k=k.split(".");for(l=0;l<k.length-1;l++){var u=k[l];if(!(u in p))return;p=p[u]}k=k[k.length-1];l=p[k];n=n(l);n!=l&&null!=n&&$jscomp.defineProperty(p,k,{configurable:!0,writable:!0,value:n})};
$jscomp.polyfillIsolated=function(k,n,p,l){var u=k.split(".");k=1===u.length;l=u[0];l=!k&&l in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<u.length-1;g++){var C=u[g];if(!(C in l))return;l=l[C]}u=u[u.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?l[u]:null;n=n(p);null!=n&&(k?$jscomp.defineProperty($jscomp.polyfills,u,{configurable:!0,writable:!0,value:n}):n!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[u]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[u]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(u):$jscomp.POLYFILL_PREFIX+p+"$"+u),$jscomp.defineProperty(l,$jscomp.propertyToPolyfillSymbol[u],{configurable:!0,writable:!0,value:n})))};$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(k){k={next:k};k[Symbol.iterator]=function(){return this};return k};
$jscomp.polyfill("Object.fromEntries",function(k){return k?k:function(n){var p={};if(!(Symbol.iterator in n))throw new TypeError(""+n+" is not iterable");n=n[Symbol.iterator].call(n);for(var l=n.next();!l.done;l=n.next()){l=l.value;if(Object(l)!==l)throw new TypeError("iterable for fromEntries should yield objects");p[l[0]]=l[1]}return p}},"es_2019","es3");
(function(){function k(a){H&&console.log("checkAxes",{heatMap:a});null!=a.mapData&&null!=a.mapConfig&&(a.initAxisLabels(),n(a),a.onready(a))}function n(a){function b(d,f,h){c.hasOwnProperty(d)?a.datalevels[d]=new J(a.tileCache,d,c[d],f?a.datalevels[f]:null):h&&(a.datalevels[d]=a.datalevels[h],a.alternateLevels.hasOwnProperty(h)||(a.alternateLevels[h]=[]),a.alternateLevels[h].push(d))}const c=a.mapConfig.data_configuration.map_information.levels;b(g.THUMBNAIL_LEVEL);b(g.SUMMARY_LEVEL,g.THUMBNAIL_LEVEL,
g.THUMBNAIL_LEVEL);b(g.DETAIL_LEVEL,g.SUMMARY_LEVEL,g.SUMMARY_LEVEL);b(g.RIBBON_VERT_LEVEL,g.SUMMARY_LEVEL,g.DETAIL_LEVEL);b(g.RIBBON_HOR_LEVEL,g.SUMMARY_LEVEL,g.DETAIL_LEVEL);p(a);a.sendCallBack(l.Event_INITIALIZED)}function p(a){const b=Object.keys(a.mapConfig.data_configuration.map_information.data_layer);a._currentDl=b[0];a.thumbnailWindowRefs=b.map(c=>a.getNewAccessWindow({layer:c,level:g.THUMBNAIL_LEVEL,firstRow:1,firstCol:1,numRows:a.getNumRows(g.THUMBNAIL_LEVEL),numCols:a.getNumColumns(g.THUMBNAIL_LEVEL)}))}
NgChm.markFile();const l=NgChm.createNS("NgChm.HEAT"),u=NgChm.importNS("NgChm.UTIL"),g=NgChm.importNS("NgChm.MAPREP"),C=NgChm.importNS("NgChm.CM"),D=NgChm.importNS("NgChm.CMM");l.Event_INITIALIZED="Init";l.Event_JSON="Json";l.Event_NEWDATA="NewData";l.Event_PLUGINS="Plugins";const H=u.getDebugFlag("heat-init");class K{constructor(a,b){const {layer:c,level:d,startRowTile:f,endRowTile:h,startColTile:m,endColTile:q}=b;var r=a.datalevels[d];(1>f||h>r.numTileRows||1>m||q>r.numTileColumns||h<f||q<m)&&console.error("Constructing TileWindow with out-of-range tiles",
b,r);this.heatMap=a;this.layer=c;this.level=d;this.startRowTile=f;this.endRowTile=h;this.startColTile=m;this.endColTile=q;this.numColumnTiles=q-m+1;this.totalTiles=(h-f+1)*this.numColumnTiles;this.tiles=Array({length:this.totalTiles});this._allTilesAvailable=!0;a=0;for(b=this.startRowTile;b<=this.endRowTile;b++)for(r=this.startColTile;r<=this.endColTile;r++)this.tiles[a]=this.heatMap.tileCache.getTileCacheData(this.layer+"."+this.level+"."+b+"."+r),this.tiles[a]||(this._allTilesAvailable=!1),a++;
this.tileStatusValid=!0}myKey(){return[this.layer,this.level,this.startRowTile,this.endRowTile,this.startColTile,this.endColTile].join(".")}isTileInWindow(a){return a.layer===this.layer&&a.level===this.level&&a.row>=this.startRowTile&&a.row<=this.endRowTile&&a.col>=this.startColTile&&a.col<=this.endColTile}checkTile(a){a.hasOwnProperty("data")||console.error("NEWDATA message has no data field",a);if(this.isTileInWindow(a)){const b=(a.row-this.startRowTile)*this.numColumnTiles+a.col-this.startColTile;
b>=this.totalTiles&&console.error("Tile idx out of range",{idx:b,tile:a,tileWindow:this});this.tiles[b]=a.data;this.tileStatusValid=!1}}getTileData(a,b){if(a>=this.startRowTile&&a<=this.endRowTile&&b>=this.startColTile&&b<=this.endColTile)return this.tiles[(a-this.startRowTile)*this.numColumnTiles+b-this.startColTile];console.error("getTileData out of limits",{tileRow:a,tileCol:b,tileWindow:this});return null}fetchTiles(){let a=0;for(let b=this.startRowTile;b<=this.endRowTile;b++)for(let c=this.startColTile;c<=
this.endColTile;c++)this.tiles[a]||(this.tiles[a]=this.heatMap.tileCache.getTileCacheData(this.layer+"."+this.level+"."+b+"."+c),this.tiles[a]||(this.tiles[a]=this.heatMap.tileCache.getTile(this.layer,this.level,b,c))),a++}allTilesAvailable(){if(this.tileStatusValid)return this._allTilesAvailable;for(let a=0;a<this.totalTiles;a++)if(!this.tiles[a])return this._allTilesAvailable=!1,this.tileStatusValid=!0,!1;return this.tileStatusValid=this._allTilesAvailable=!0}onready(a){const b=this,c=new Promise((d,
f)=>{function h(m,q){return q.layer==m.layer&&q.level==m.level&&m.allTilesAvailable()?(d(m),!0):!1}b.allTilesAvailable()?d(b):b.heatMap.tileWindowListeners.push({tileWindow:b,checkReady:h})});if(a)c.then(a);else return c}}class L{constructor(a){this.heatMap=a;this.cacheEntries={};this.longestLoadTime=0}createTileCacheEntry(a){const [b,c,d,f]=a.split(".");return this.cacheEntries[a]={props:{layer:b,level:c,row:d|0,col:f|0},data:null,fetchTime:0,loadTime:0,fetches:0,failedFetches:0,dataSize:0}}haveTileData(a){return null!=
this.getTileCacheData(a)}getTile(a,b,c,d){const f=a+"."+b+"."+c+"."+d;let h=!0,m=this.cacheEntries[f];if(m){const q=this.getEntryData(f,m);if(q)return q;0<m.fetchTime&&(performance.now()-m.fetchTime<Math.max(3E3,1.25*this.longestLoadTime)?h=!1:m.failedFetches++)}else m=this.createTileCacheEntry(f);h&&(m.fetches++,m.fetchTime=performance.now());this.heatMap.loadHeatMapTile({tileCacheName:f,layer:a,level:b,tileName:b+"."+c+"."+d});return null}showTileCacheStats(){for(let a in this.cacheEntries){const b=
this.cacheEntries[a];if(b.data){const c=b.loadTime-b.fetchTime;console.log({tileCacheName:a,fetches:b.fetches,KBytes:b.dataSize/1024,loadTime:c,loadTimePerKByte:c/b.dataSize*1024})}}console.log("Longest load time: "+this.longestLoadTime)}resetTileCacheEntry(a){const b=this.cacheEntries[a];b&&(a=this.getEntryData(a,b),b.fetchTime=0,a||b.failedFetches++)}getTileCacheData(a){const b=this.cacheEntries[a];return b?this.getEntryData(a,b):null}getEntryData(a,b){if(null===b.data)return null;a=b.data.deref();
null==a&&(b.data=null);return a}setTileCacheEntry(a,b){a=this.cacheEntries[a];a.loadTime=performance.now();const c=a.loadTime-a.fetchTime;c>this.longestLoadTime&&(this.longestLoadTime=c);a.data=new WeakRef(b);a.dataSize=b.length;this.heatMap.updateTileWindows(Object.assign({},a.props,{data:b}))}}class M{constructor(a,b){this.heatMap=a;this.win={layer:b.layer,level:b.level,firstRow:b.firstRow|0,firstCol:b.firstCol|0,numRows:b.numRows|0,numCols:b.numCols|0};this.tileWindow=a.getTileWindow(this.win);
this.tileWindow.fetchTiles();this.datalevel=a.datalevels[this.win.level]}getValue(a,b){return this.datalevel.getLayerValue(this.win.layer,this.tileWindow,a|0,b|0)}getRowValues(a,b,c){b||(b=this.win.firstCol);c||(c=this.win.firstCol+this.win.numCols-b);return this.datalevel.getRowValues(this.tileWindow,a,b,c)}allTilesAvailable(){return this.tileWindow.allTilesAvailable()}onready(a){const b=this.tileWindow.onready();if(a)b.then(()=>a(this));else return b.then(()=>this)}isTileInWindow(a){return this.tileWindow.isTileInWindow(a)}}
class e{constructor(a,b,c,d){this.initialized=!1;this.savedVersion=this.version=0;this.mapName=a;this.mapData=this.mapConfig=null;this.datalevels={};this.alternateLevels={};this.colorMapMgr=null;this.currentTileRequests=[];this.pendingTileRequests=[];this.searchOptions=[];this.updatedOnLoad=!1;this.onready=d;this.initEventListeners(b);this.initTileWindows();this.tileCache=new L(this);this.loadTile=c(this)}}l.HeatMap=e;e.prototype.setCurrentDL=function(a){this._currentDl!=a&&(this._currentDl=a,this.setSelectionColors())};
e.prototype.getCurrentDL=function(){return this._currentDl};e.prototype.getCurrentColorMap=function(){return this.getColorMapManager().getColorMap("data",this.getCurrentDL())};e.prototype.setSelectionColors=function(){var a=this.getColorMapManager().getColorMap("data",this._currentDl);const b=this.getDataLayers()[this._currentDl];var c=D.hexToRgba(b.selection_color);a=a.isColorDark(c)?"#000000":"#FFFFFF";c=document.documentElement;c.style.setProperty("--in-selection-color",a);c.style.setProperty("--in-selection-background-color",
b.selection_color)};e.prototype.getMapConfig=function(){return this.mapConfig};e.prototype.isMapLoaded=function(){return null!==this.mapConfig};e.prototype.isReadOnly=function(){return"Y"===this.mapConfig.data_configuration.map_information.read_only};e.prototype.getAxisConfig=function(a){return g.isRow(a)?this.getRowConfig():this.getColConfig()};e.prototype.getRowConfig=function(){return this.mapConfig.row_configuration};e.prototype.getColConfig=function(){return this.mapConfig.col_configuration};
e.prototype.getAxisCovariateConfig=function(a,b){a=this.getAxisConfig(a).classifications;if(!b)return a;let c=Object.entries(a);Object.entries(b).forEach(([d,f])=>{"type"==d?c=c.filter(([,h])=>h.color_map.type==f):"show"==d?c=c.filter(([,h])=>h.show==f):console.error("Unknown covariate filter",{filter:d,value:f})});return Object.fromEntries(c)};e.prototype.addCovariate=function(a,b,c){c={bar_type:"color_plot",bg_color:"#fefefe",color_map:{type:c,thresholds:"discrete"==c?[]:[0,100],colors:"discrete"==
c?[]:["#fefefe","#3f3f3f"],missing:"#111111"},fg_color:"#888888",height:10,high_bound:"100",low_bound:"0",show:"Y",missingColor:"#212121"};var d=this.getAxisConfig(a);d.classifications_order.includes(b)?console.warn("HeatMap.addCovariate: covariate already exists",{axis:a,covariateName:b,axisConfig:d}):d.classifications_order.push(b);d.classifications[b]=c;d=this.getAxisCovariateData(a);const f=this.getNumAxisElements(a,"d"),h={values:Array(f).fill("NA")};a=this.getNumAxisElements(a,"s");a!=f&&(h.svalues=
Array(a).fill("NA"));d[b]=h;return c};e.prototype.summarizeCovariate=function(a,b,c){a=this.getAxisCovariateData(a)[b];if(a.hasOwnProperty("svalues")){b=a.values.length/a.svalues.length;var d=0;for(let h=0;h<a.svalues.length;h++){var f=Math.floor(b*(h+1)-1E-10);let m=new Map,q=0,r=0;for(;d<f;){const t=a.values[d++];"discrete"==c?m.set(t,(m.get(t)||0)+1):isNaN(t)||(q+=t,r++)}if("discrete"==c){f=0;let t;for(const [v,A]of m)A>f&&(f=A,t=v);a.svalues[h]=t}else a.svalues[h]=0==r?NaN:q/r}}};e.prototype.getAxisCovariateOrder=
function(a){return g.isRow(a)?this.getRowClassificationOrder():this.getColClassificationOrder()};e.prototype.getRowClassificationConfig=function(){return this.mapConfig.row_configuration.classifications};e.prototype.getRowClassificationConfigOrder=function(){return this.mapConfig.row_configuration.classifications_order};e.prototype.getColClassificationConfig=function(){return this.mapConfig.col_configuration.classifications};e.prototype.getColClassificationConfigOrder=function(){return this.mapConfig.col_configuration.classifications_order};
e.prototype.getCovariateBarTypes=function(a){return Object.entries(this.getAxisCovariateConfig(a)).map(([,b])=>"Y"===b.show?b.bar_type:0)};e.prototype.getCovariateType=function(a,b){return(a=this.getAxisCovariateConfig(a)[b])?a.color_map.type:void 0};e.prototype.getCovariateThresholds=function(a,b){return(a=this.getAxisCovariateConfig(a)[b])?[...a.color_map.thresholds]:void 0};e.prototype.genAllCovars=function*(){for(const a of["row","col"]){const b=this.getAxisCovariateOrder(a);for(const c of b)yield{axis:a,
key:c}}};e.prototype.getCovariateBarParams=function(a){return Object.entries(this.getAxisCovariateConfig(a)).map(([,b])=>{b="Y"===b.show?"color_plot"==b.bar_type?{color_map:b.color_map}:{bg_color:b.bg_color,fg_color:b.fg_color,low_bound:b.low_bound,high_bound:b.high_bound}:{};return b})};e.prototype.getRowClassificationOrder=function(a){var b=this.mapConfig.row_configuration.classifications_order;if("undefined"===typeof b)for(key in b=[],this.mapConfig.row_configuration.classifications)b.push(key);
if("undefined"===typeof a)return b;a=[];for(var c=0;c<b.length;c++){var d=b[c];"Y"==this.mapConfig.row_configuration.classifications[d].show&&a.push(d)}return a};e.prototype.setRowClassificationOrder=function(){null!==this.mapConfig&&(this.mapConfig.row_configuration.classifications_order=this.getRowClassificationOrder())};e.prototype.getColClassificationOrder=function(a){var b=this.mapConfig.col_configuration.classifications_order;if("undefined"===typeof b)for(key in b=[],this.mapConfig.col_configuration.classifications)b.push(key);
if("undefined"===typeof a)return b;a=[];for(var c=0;c<b.length;c++){var d=b[c];"Y"==this.mapConfig.col_configuration.classifications[d].show&&a.push(d)}return a};const N={r:0,g:0,b:0,a:0},O=D.hexToRgba("#FFFFFF");class P{constructor(a,b,c,d){Object.assign(this,c,{idx:b,label:a,height:c.height*d|0})}getScatterBarPlotColors(){const a=D.hexToRgba(this.fg_color);return["#FFFFFF"===this.subBgColor?N:D.hexToRgba(this.bg_color),a,O]}}e.prototype.getScaledVisibleCovariates=function(a,b){const c=g.isRow(a)?
this.mapConfig.row_configuration:this.mapConfig.col_configuration;a=(c.hasOwnProperty("classifications_order")?c.classifications_order:Object.keys(c.classifications)).map((d,f)=>new P(d,f,c.classifications[d],b)).filter(d=>"Y"===d.show);Object.defineProperty(a,"totalHeight",{value:function(){return this.map(d=>d.height).reduce((d,f)=>d+f,0)},enumerable:!1});Object.defineProperty(a,"containsLegend",{value:function(){return 0<this.filter(d=>"color_plot"!==d.bar_type).length},enumerable:!1});return a};
e.prototype.hasHiddenCovariates=function(a){const b=g.isRow(a)?this.mapConfig.row_configuration:this.mapConfig.col_configuration;return 0<(b.hasOwnProperty("classifications_order")?b.classifications_order:Object.keys(b.classifications)).map(c=>b.classifications[c].show).filter(c=>"Y"!==c).length};e.prototype.setColClassificationOrder=function(){null!==this.mapConfig&&(this.mapConfig.col_configuration.classifications_order=this.getColClassificationOrder())};e.prototype.getMapInformation=function(){return this.mapConfig.data_configuration.map_information};
e.prototype.getDataLayers=function(){return this.mapConfig.data_configuration.map_information.data_layer};e.prototype.getCurrentDataLayer=function(){return this.getDataLayers()[this.getCurrentDL()]};e.prototype.getSortedLayers=function(){return Object.entries(this.getDataLayers()).sort(function(a,b){return Number(a[0].substr(2))-Number(b[0].substr(2))})};e.prototype.getDividerPref=function(){return this.mapConfig.data_configuration.map_information.summary_width};e.prototype.setDividerPref=function(a){if(void 0===
a){a=document.getElementById("ngChmContainer");var b=document.getElementById("summary_chm");a=Math.ceil(100*b.clientWidth/a.clientWidth)}this.mapConfig.data_configuration.map_information.summary_width=a;this.mapConfig.data_configuration.map_information.detail_width=100-a};e.prototype.setClassificationPrefs=function(a,b,c,d){g.isRow(b)?(this.mapConfig.row_configuration.classifications[a].show=c?"Y":"N",this.mapConfig.row_configuration.classifications[a].height=parseInt(d)):(this.mapConfig.col_configuration.classifications[a].show=
c?"Y":"N",this.mapConfig.col_configuration.classifications[a].height=parseInt(d))};e.prototype.setClassBarScatterPrefs=function(a,b,c,d,f,h,m){g.isRow(b)?(this.mapConfig.row_configuration.classifications[a].bar_type=c,"undefined"!==typeof d&&(this.mapConfig.row_configuration.classifications[a].low_bound=d,this.mapConfig.row_configuration.classifications[a].high_bound=f,this.mapConfig.row_configuration.classifications[a].fg_color=h,this.mapConfig.row_configuration.classifications[a].bg_color=m)):(this.mapConfig.col_configuration.classifications[a].bar_type=
c,"undefined"!==typeof d&&(this.mapConfig.col_configuration.classifications[a].low_bound=d,this.mapConfig.col_configuration.classifications[a].high_bound=f,this.mapConfig.col_configuration.classifications[a].fg_color=h,this.mapConfig.col_configuration.classifications[a].bg_color=m))};e.prototype.setLayerGridPrefs=function(a,b,c,d,f){this.mapConfig.data_configuration.map_information.data_layer[a].grid_show=b?"Y":"N";this.mapConfig.data_configuration.map_information.data_layer[a].grid_color=c;this.mapConfig.data_configuration.map_information.data_layer[a].cuts_color=
f;this.mapConfig.data_configuration.map_information.data_layer[a].selection_color=d;a==this.getCurrentDL()&&this.setSelectionColors()};e.prototype.getRowOrganization=function(){return this.mapConfig.row_configuration.organization};e.prototype.getColOrganization=function(){return this.mapConfig.col_configuration.organization};e.prototype.getMapInformation=function(){return this.mapConfig.data_configuration.map_information};e.prototype.getPanelConfiguration=function(){return this.mapConfig.panel_configuration};
e.prototype.getRowDendroConfig=function(){return this.mapConfig.row_configuration.dendrogram};e.prototype.getColDendroConfig=function(){return this.mapConfig.col_configuration.dendrogram};e.prototype.getAxisDendroConfig=function(a){return this.getAxisConfig(a).dendrogram};e.prototype.setRowDendrogramShow=function(a){this.mapConfig.row_configuration.dendrogram.show=a};e.prototype.setColDendrogramShow=function(a){this.mapConfig.col_configuration.dendrogram.show=a};e.prototype.setRowDendrogramHeight=
function(a){this.mapConfig.row_configuration.dendrogram.height=a};e.prototype.setColDendrogramHeight=function(a){this.mapConfig.col_configuration.dendrogram.col_dendro_height=a};e.prototype.showRowDendrogram=function(a){var b=!0,c=this.mapConfig.row_configuration.dendrogram.show;if("NONE"===c||"NA"===c)b=!1;"DETAIL"===a&&"SUMMARY"===c&&(b=!1);return b};e.prototype.showColDendrogram=function(a){var b=!0,c=this.mapConfig.col_configuration.dendrogram.show;if("NONE"===c||"NA"===c)b=!1;"DETAIL"===a&&"SUMMARY"===
c&&(b=!1);return b};e.prototype.getTopItems=function(a,b={}){var c=this.getAxisConfig(a);const d=c.top_items_cv;if(""==d)return[];if("--text-entry--"==d)return(c.top_items||[]).sort();this["__cvOrder"+a]||(this["__cvOrder"+a]=new Map);c=this["__cvOrder"+a];let f;if(c.has(d))f=c.get(d);else{const m=this.getAxisCovariateData(a)[d].values;f=m.map((r,t)=>t);const q=m.map(r=>Math.random());f=f.filter(r=>"NA"!=m[r]);f.sort((r,t)=>m[t]-m[r]||q[t]-q[r]);c.set(d,f)}b.hasOwnProperty("count")&&(f=f.slice(0,
b.count));const h=this.getAxisLabels(a).labels;return f.map(m=>h[m]).sort()};e.prototype.setReadOnly=function(){this.mapConfig.data_configuration.map_information.read_only="Y"};e.prototype.saveDataSentToPluginToMapConfig=function(a,b,c){try{var d=document.querySelectorAll('[data-nonce="'+a+'"]')[0].parentElement.parentElement}catch(f){throw"Cannot determine pane for given nonce";}a=d.id;this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration.hasOwnProperty(a)&&
null!=this.mapConfig.panel_configuration[a]||(this.mapConfig.panel_configuration[a]={});b&&(this.mapConfig.panel_configuration[a].config=b);c&&(this.mapConfig.panel_configuration[a].data=c);this.mapConfig.panel_configuration[a].type="plugin";this.mapConfig.panel_configuration[a].pluginName=d.dataset.pluginName};e.prototype.removePaneInfoFromMapConfig=function(a){this.mapConfig.hasOwnProperty("panel_configuration")&&(this.mapConfig.panel_configuration[a]=null)};e.prototype.saveLinkoutPaneToMapConfig=
function(a,b,c){this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration[a]={type:"linkout",url:b,paneTitle:c}};e.prototype.saveDataFromPluginToMapConfig=function(a,b){try{var c=document.querySelectorAll('[data-nonce="'+a+'"]')[0].parentElement.parentElement.id}catch(d){throw"Cannot determine pane for given nonce";}this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration.hasOwnProperty(c)&&
null!=this.mapConfig.panel_configuration[c]||(this.mapConfig.panel_configuration[c]={});this.mapConfig.panel_configuration[c].dataFromPlugin=b};e.prototype.getAxisCovariateData=function(a){return g.isRow(a)?this.mapData.row_data.classifications:this.mapData.col_data.classifications};e.prototype.getRowClassificationData=function(){return this.mapData.row_data.classifications};e.prototype.getColClassificationData=function(){return this.mapData.col_data.classifications};e.prototype.getAxisLabels=function(a){return g.isRow(a)?
this.mapData.row_data.label:this.mapData.col_data.label};e.prototype.getRowLabels=function(){return this.mapData.row_data.label};e.prototype.getColLabels=function(){return this.mapData.col_data.label};e.prototype.getLabelTypes=function(a){a=this.getAxisLabels(a);return I(a.labelTypes)};e.prototype.setLabelTypes=function(a,b){return this.getAxisLabels(a).labelTypes=I(b)};function I(a){return a.map(b=>({type:b.type,visible:b.visible}))}e.prototype.getDendrogramData=function(a){return((g.isRow(a)?this.mapData.row_data.dendrogram:
this.mapData.col_data.dendrogram)||[]).map(b=>{b=b.split(",");return{left:Number(b[0]),right:Number(b[1]),height:Number(b[2])}})};e.prototype.getTotalRows=function(){return this.datalevels[g.DETAIL_LEVEL].totalRows};e.prototype.getSummaryRowRatio=function(){return null!==this.datalevels[g.SUMMARY_LEVEL]?this.datalevels[g.SUMMARY_LEVEL].rowSummaryRatio:this.datalevels[g.THUMBNAIL_LEVEL].rowSummaryRatio};e.prototype.getSummaryColRatio=function(){return null!==this.datalevels[g.SUMMARY_LEVEL]?this.datalevels[g.SUMMARY_LEVEL].colSummaryRatio:
this.datalevels[g.THUMBNAIL_LEVEL].col_summaryRatio};e.prototype.getTotalRows=function(){return this.datalevels[g.DETAIL_LEVEL].totalRows};e.prototype.getTotalCols=function(){return this.datalevels[g.DETAIL_LEVEL].totalColumns};e.prototype.getTotalElementsForAxis=function(a){const b=this.datalevels[g.DETAIL_LEVEL];return g.isRow(a)?b.totalRows:b.totalColumns};e.prototype.getNumAxisElements=function(a,b){b=this.datalevels[b];return g.isRow(a)?b.totalRows:b.totalColumns};e.prototype.getNumRows=function(a){return this.datalevels[a].totalRows};
e.prototype.getNumColumns=function(a){return this.datalevels[a].totalColumns};e.prototype.getRowSummaryRatio=function(a){return this.datalevels[a].rowSummaryRatio};e.prototype.getColSummaryRatio=function(a){return this.datalevels[a].colSummaryRatio};e.prototype.getValue=function(a,b,c){return this.getNewAccessWindow({layer:this._currentDl,level:a,firstRow:b,firstCol:c,numRows:1,numCols:1}).getValue(b,c)};e.prototype.getAllAlternateLevels=function(a){function b(d){d=c.hasOwnProperty(d)?c[d]:[];const f=
d.map(h=>b(h));return[...(new Set(f.concat(d).flat()))]}const c=this.alternateLevels;return b(a)};Object.assign(e.prototype,{initEventListeners:function(a){this.eventListeners=a.slice(0)},addEventListener:function(a){this.eventListeners.push(a.bind(this))},sendAllListeners:function(a,b){this.eventListeners.forEach(c=>c(a,b));if(a===l.Event_NEWDATA){const {layer:c,level:d,row:f,col:h,data:m}=b,q=this.getAllAlternateLevels(d);for(;0<q.length;){const r={layer:c,level:q.shift(),row:f,col:h,data:m};this.eventListeners.forEach(t=>
t(a,r))}}}});e.prototype.getColorMapManager=function(){if(null==this.mapConfig)return null;null==this.colorMapMgr&&(this.colorMapMgr=new D.ColorMapManager(this));return this.colorMapMgr};e.prototype.initTileWindows=function(){this.tileWindowListeners=[];this.tileWindowRefs=new Map};e.prototype.updateTileWindows=function(a){this.tileWindowRefs.forEach((c,d)=>{(c=c.deref())?c.checkTile(a):this.tileWindowRefs.delete(d)});let b=0;for(;b<this.tileWindowListeners.length;){const c=this.tileWindowListeners[b];
c.checkReady(c.tileWindow,a)?this.tileWindowListeners.splice(b,1):b++}this.sendCallBack(l.Event_NEWDATA,a)};e.prototype.tileIdReferenced=function(a){const [b,c,d,f]=a.split(".");var h=!1;this.tileWindowRefs.forEach((m,q)=>{const [r,t,v,A,G,F]=q.split(".");r==b&&t==c&&(d|0)>=(v|0)&&(d|0)<=(A|0)&&(f|0)>=(G|0)&&(f|0)<=(F|0)&&(h=!0)});return h};e.prototype.hasGaps=function(){return 0!=this.getMapInformation().map_cut_rows+this.getMapInformation().map_cut_cols};e.prototype.getVersion=function(){return this.version};
e.prototype.setUnAppliedChanges=function(a){a?this.version++:this.savedVersion=this.version};e.prototype.getUnAppliedChanges=function(){return this.version!=this.savedVersion};e.prototype.sendCallBack=function(a,b){if(a===l.Event_INITIALIZED||a===l.Event_JSON||a===l.Event_NEWDATA&&b.level===g.THUMBNAIL_LEVEL){null!=this.mapData&&null!=this.mapConfig&&0<Object.keys(this.datalevels).length&&this.tileCache.haveTileData(this.getCurrentDL()+"."+g.THUMBNAIL_LEVEL+".1.1")&&!this.initialized&&(this.initialized=
!0,this.mapConfig.hasOwnProperty("panel_configuration")||u.hideLoader(!0),this.sendAllListeners(l.Event_INITIALIZED));const c=this.tileCache.getTileCacheData(this.getCurrentDL()+"."+g.SUMMARY_LEVEL+".1.1");c&&this.sendAllListeners(l.Event_NEWDATA,{layer:this.getCurrentDL(),level:g.SUMMARY_LEVEL,row:1,col:1,data:c})}a===l.Event_NEWDATA&&this.initialized&&this.sendAllListeners(a,b)};e.prototype.getNewTileWindow=function(a){const b=[a.layer,a.level,a.startRowTile,a.endRowTile,a.startColTile,a.endColTile].join(".");
if(this.tileWindowRefs.has(b)){const c=this.tileWindowRefs.get(b).deref();if(c)return c}a=new K(this,a);this.tileWindowRefs.set(b,new WeakRef(a));return a};e.prototype.getTileWindow=function(a){return this.datalevels[a.level].getTileAccessWindow(a.layer,a.firstRow,a.firstCol,a.numRows,a.numCols,b=>this.getNewTileWindow(b))};e.prototype.getNewAccessWindow=function(a){return new M(this,a)};e.prototype.getSummaryHist=function(a,b,c){c-=b;const d=Array(11).join("0").split("").map(parseFloat),f=Array(10).join("0").split("").map(parseFloat);
for(let q=0;q<f.length;q++)f[q]+=b+c/(f.length-1)*q;b=this.getNumColumns(g.SUMMARY_LEVEL);const h=this.getNumRows(g.SUMMARY_LEVEL),m=this.getNewAccessWindow({layer:a,level:g.SUMMARY_LEVEL,firstRow:1,firstCol:1,numRows:h,numCols:b});return m.onready().then(q=>{q=0;for(var r=1;r<=h;r++)for(var {value:t}of m.getRowValues(r))if(isNaN(t)||t>=g.maxValues)q++;else if(t>g.minValues){for(var v=0;v<f.length&&t>=f[v];)v++;d[v]++}t=0;r=q;for(v=0;v<d.length;v++)d[v]>r&&(r=d[v]),t+=d[v];return{breaks:f,bins:d,
binMax:r,total:t,nan:q}})};e.prototype.addJson=function(a,b){H&&console.log(`Adding ${a}.json to heatMap`,{data:b});switch(a){case "mapData":this.mapData=b;C.mapDataCompatibility(this.mapData)&&(this.mapUpdatedOnLoad=!0);k(this);this.sendCallBack(l.Event_JSON);break;case "mapConfig":C.CompatibilityManager(b)&&(this.mapUpdatedOnLoad=!0);this.mapConfig=b;k(this);this.sendCallBack(l.Event_JSON);break;default:console.error("HeatMap.addJson: Unknown json object",{name:a,data:b})}};class J{constructor(a,
b,c,d){this.tileCache=a;this.level=b;this.totalRows=c.total_rows;this.totalColumns=c.total_cols;this.numTileRows=c.tile_rows;this.numTileColumns=c.tile_cols;this.rowsPerTile=c.rows_per_tile;this.colsPerTile=c.cols_per_tile;this.rowSummaryRatio=c.row_summary_ratio;this.colSummaryRatio=c.col_summary_ratio;this.lowerLevel=d;this.rowToLower=null===d?null:this.totalRows/d.totalRows;this.colToLower=null===d?null:this.totalColumns/d.totalColumns;this.lastTileWindow=null;this.isLineACut=Array(this.totalRows);
this.colsInLastTile=this.totalColumns%this.colsPerTile;0==this.colsInLastTile&&(this.colsInLastTile=this.colsPerTile);this.rowsInLastTile=this.totalRows%this.rowsPerTile;0==this.rowsInLastTile&&(this.rowsInLastTile=this.rowsPerTile)}numRowsInTile(a){return a<this.numTileRows?this.rowsPerTile:this.rowsInLastTile}numColsInTile(a){return a<this.numTileColumns?this.colsPerTile:this.colsInLastTile}getLayerValue(a,b,c,d){const f=Math.floor((c-1)/this.rowsPerTile)+1,h=Math.floor((d-1)/this.colsPerTile)+
1;!b&&this.lastTileWindow&&this.lastTileWindow.layer==a&&f>=this.lastTileWindow.startRowTile&&f<=this.lastTileWindow.endRowTile&&h>=this.lastTileWindow.startColTile&&h<=this.lastTileWindow.endColTile?b=this.lastTileWindow:b||(this.lastTileWindow=b=this.tileCache.heatMap.getNewTileWindow({layer:a,level:this.level,startRowTile:f,endRowTile:this.numTileRows,startColTile:1,endColTile:this.numTileColumns}));return(b=b.getTileData(f,h))?(a=this.numColsInTile(h),b[(c-1)%this.rowsPerTile*a+(d-1)%this.colsPerTile]):
null!=this.lowerLevel?this.lowerLevel.getLayerValue(a,null,Math.floor((c-1)/this.rowToLower)+1,Math.floor((d-1)/this.colToLower)+1):0}getRowValues(a,b,c,d){const f=a.layer;b|=0;c|=0;const h=Math.floor((b-1)/this.rowsPerTile)+1,m=(b-1)%this.rowsPerTile,q={},r=this,t=this.lowerLevel,v=this.colsPerTile,A=((b-1)/this.rowToLower|0)+1,G=this.colToLower,F=1/this.colToLower;q[Symbol.iterator]=function*(){for(let z=0;z<d;){var x=((c+z-1)/v|0)+1,B=r.numColsInTile(x),w=a.getTileData(h,x);x=Math.min(x*v-c-z+
1,d-z);let y=z;if(w){B=m*B+(c+z-1)%v;for(let E=0;E<x;E++)yield{i:y,col:c+y,value:w[B+E]},y++}else if(t){w=((c+z-1)*F|0)+1;B=t.tileCache.heatMap.getNewAccessWindow({layer:f,level:t.level,firstRow:A,firstCol:w,numRows:1,numCols:((c+z+x-2)*F|0)+1-w+1}).getRowValues(A);w=0;for(let {i:E,value:Q}of B)for(B=Math.min((E+1)*G|0,x);w<B;)yield{i:y,col:c+y,value:Q},y++,w++;for(;w<x;)yield{i:w,col:c+y,value:0},w++}else for(w=0;w<x;w++)yield{i:y,col:c+y,value:0},y++;z+=x}};return q}getTileAccessWindow(a,b,c,d,
f,h){return h({layer:a,level:this.level,startRowTile:Math.floor((b-1)/this.rowsPerTile)+1,endRowTile:Math.ceil((b+d-1)/this.rowsPerTile),startColTile:Math.floor((c-1)/this.colsPerTile)+1,endColTile:Math.ceil((c+f-1)/this.colsPerTile)})}}(function(){e.prototype.initAxisLabels=function(){this.actualAxisLabels={};this.shownAxisLabels={ROW:[],COLUMN:[]};this.shownAxisLabelParams={ROW:{},COLUMN:{}}};e.prototype.getTypeValues=function(a,b){const c=this.getLabelTypes(a).map(d=>d.type).indexOf(b);return-1!=
c?this.getAxisLabels(a).labels.map(d=>{if(!d)return"";d=d.split("|");return void 0==d[c]?"":d[c]}):[]};e.prototype.actualLabels=function(a){a=g.isRow(a)?"ROW":"COLUMN";if(!this.actualAxisLabels.hasOwnProperty(a)){const b=this.getAxisLabels(a).labels,c=this.getLabelTypes(a);this.actualAxisLabels[a]=b.map(d);function d(f){return f.split("|").filter((h,m)=>c[m]&&c[m].visible).join("|")}}return this.actualAxisLabels[a]};e.prototype.getVisibleLabel=function(a,b){const c=this.getLabelTypes(b);return a.split("|").filter((d,
f)=>c[f]&&c[f].visible).join("|")};e.prototype.shownLabels=function(a){a=g.isRow(a)?"ROW":"COLUMN";var b=this.getAxisConfig(a);if(this.shownAxisLabelParams[a].label_display_length!==b.label_display_length||this.shownAxisLabelParams[a].label_display_method!==b.label_display_method)this.shownAxisLabelParams[a].label_display_length=b.label_display_length,this.shownAxisLabelParams[a].label_display_method=b.label_display_method,b=this.actualLabels(a),this.shownAxisLabels[a]=b.map(c=>void 0===c?"":this.getLabelText(c,
a));return this.shownAxisLabels[a]};e.prototype.getLabelText=function(a,b,c){b=g.isRow(b)?"ROW":"COLUMN";var d=this.getAxisConfig(b);b=parseInt(d.label_display_length);d=d.label_display_method;"undefined"!==typeof c&&(b=16);a.length>b&&(a="END"===d?a.substr(0,b-3)+"...":"MIDDLE"===d?a.substr(0,b/2-1)+"..."+a.substr(a.length-(b/2-2),a.length):"..."+a.substr(a.length-(b-3),a.length));return a}})();e.prototype.loadHeatMapTile=function(a){var b=a.tileCacheName;this.tileCache.getTileCacheData(b)||this.currentTileRequests.includes(b)||
(b=this.pendingTileRequests.map(c=>c.tileCacheName).indexOf(b),0<=b&&this.pendingTileRequests.splice(b,1),this.pendingTileRequests.push(a),10<this.currentTileRequests.length||this.submitFirstPendingTileRequest())};e.prototype.tileRequestComplete=function(a,b){const c=this.currentTileRequests.indexOf(a);0>c?console.error("Tile has disappeared from currentTileRequests",{tileCacheName:a,currentTileRequests:this.currentTileRequests}):(this.currentTileRequests.splice(c,1),this.submitFirstPendingTileRequest());
b?this.tileCache.setTileCacheEntry(a,b):this.tileCache.resetTileCacheEntry(a)};e.prototype.submitFirstPendingTileRequest=function(){let a=0==this.pendingTileRequests.length?null:this.pendingTileRequests.pop();for(;a&&!this.tileIdReferenced(a.tileCacheName);)a=0==this.pendingTileRequests.length?null:this.pendingTileRequests.pop();a&&(this.currentTileRequests.push(a.tileCacheName),this.loadTile(a))};e.prototype.addSearchOption=function(a){this.searchOptions.push(a)};e.prototype.getSearchOptions=function(){return this.searchOptions}})();
(function(){function E(a,b,e){const d=document.createElement("form");d.action=b;d.method=a;e&&(a=document.createElement("textarea"),a.name="configData",a.id="configData",a.value=e,d.appendChild(a));d.style.display="none";document.body.appendChild(d);d.submit()}function x(){this.worker=null;this.mapsInitialized=0}function z(){this.fileSrc=g.ZIP_SOURCE;this.mapNames=[];this.zipFiles={}}NgChm.markFile();const g=NgChm.createNS("NgChm.MMGR"),C=NgChm.importNS("NgChm.UTIL"),F=NgChm.importNS("NgChm.HEAT"),
v=NgChm.importNS("NgChm.UHM");NgChm.importNS("NgChm.CM");const H=C.getDebugFlag("mmgr"),w=C.getDebugFlag("mmgr-worker");g.API_SOURCE="api";g.WEB_SOURCE="web";g.ZIP_SOURCE="zip";var m=null;g.getSource=function(){if(!m)throw"trying to get NG-CHM source before it has been determined";return m.fileSrc};g.callServlet=E;g.getApi=function(){if(!m)throw"cannot get API before ngchmLoader defined";if(m.fileSrc!=g.API_SOURCE)throw`cannot get API for source type ${m.fileSrc}`;return m.baseURL};x.prototype.createWorker=
function(a,b,e){function d(c){if(active===maxActiveRequests)pending.push(c);else{active++;var h=new XMLHttpRequest;h.open("GET",tileURL(c),!0);h.responseType="arraybuffer";h.onreadystatechange=function(){h.readyState==h.DONE&&(active--,0<pending.length&&d(pending.shift()),200!=h.status?postMessage({op:"tileLoadFailed",mapId:c.mapId,job:c}):postMessage({op:"tileLoaded",mapId:c.mapId,job:c,buffer:h.response},[h.response]))};h.send()}}function f(c,h,y){const l=new XMLHttpRequest;l.open("GET",jsonFileURL(c,
h),!0);l.responseType="json";l.onreadystatechange=function(){l.readyState==l.DONE&&(200!=l.status?postMessage({op:"jsonLoadFailed",mapName:y,mapId:h,name:c}):postMessage({op:"jsonLoaded",mapName:y,mapId:h,name:c,json:l.response}))};l.send()}function k(c){debug&&console.log({m:"Worker: got message",e:c,t:performance.now()});"loadTile"===c.data.op?d(c.data.job):"loadMapById"===c.data.op?p(c.data.mapId,""):"loadMapByName"===c.data.op?u(c.data.mapName):console.error("WebWorker: Unknown message received",
{message:c.data})}function p(c,h){f("mapConfig",c,h);f("mapData",c,h)}function u(c){fetch(nameLookupURL+c).then(h=>{200===h.status?h.json().then(y=>{mapId=y.data.id;p(mapId,c)}):postMessage({op:"jsonLoadFailed",name:"GetMapByName",mapName:c})})}var q=a.fileSrc;this.baseURL=function(){let c=document.location.origin;const h=a.options.repository;if("http"==h.substring(0,4)){if(!C.isValidURL(h))throw`badly formed URL ${h}`;c=h}else"/"!==h[0]&&(c+="/"+window.location.pathname.substring(1,window.location.pathname.lastIndexOf("/")+
1)),c+=h;"/"!=c[c.length-1]&&(c+="/");return c}(q);this.fileSrc=q;this.updateCallbacks=b;this.ngChmsLoaded=e;b=`const debug = ${w};`;b=b+"const maxActiveRequests = 2;var active = 0;const pending = [];"+`const baseURL = "${this.baseURL}";`;q==g.API_SOURCE&&(b+=`const nameLookupURL = "${this.baseURL}/GetMapByName/";`);b+="function tileURL(job){return baseURL+";b=q===g.API_SOURCE?b+'"GetTile?map=" + job.mapId + "&datalayer=" + job.layer + "&level=" + job.level + "&tile=" + job.tileName':b+'job.mapId+"/"+job.layer+"/"+job.level+"/"+job.tileName+".tile"';
b=b+";}"+d.toString();b+="function jsonFileURL(name, mapId){return baseURL+";b=q===g.API_SOURCE?b+'"GetDescriptor?map=" + mapId + "&type=" + name':b+'mapId+"/"+name+".json"';b=b+";}"+f.toString();b+=k.toString();b+=p.toString();q==g.API_SOURCE&&(b+=u.toString());b+=`onmessage = ${k.name};`;w&&(b+="console.log ({ m:'TileLoader loaded', t: performance.now() });");q=new Blob([b],{type:"application/javascript"});w&&console.log({m:"WebLoader.createWorker",blob:q,wS:b});this.worker=new Worker(URL.createObjectURL(q));
const r=this,t=[];r.worker.onmessage=function(c){w&&console.log("Saving pending message",{data:c.data});"jsonLoaded"===c.data.op&&"mapConfig"==c.data.name&&(w&&console.log("Peeking at mapConfig",{data:c.data}),r.getHeatMap(c.data));t.push(c)};r.setMessageHandler=function(c){setTimeout(function(){for(;0<t.length;)c(t.shift());r.worker.onmessage=c},0)};this.connectMessageHandler()};x.prototype.openMapsById=function(a){for(const b of a)this.worker.postMessage({op:"loadMapById",mapId:b})};x.prototype.openMapsByName=
function(a){for(const b of a)this.worker.postMessage({op:"loadMapByName",mapName:b})};const B=new Map;x.prototype.getHeatMap=function(a){let b;B.has(a.mapId)?b=B.get(a.mapId):(b=new F.HeatMap(a.mapName,this.updateCallbacks,this.getTileLoaderGetter(a.mapId),()=>this.noteInitialized()),b.loadSpec={mapId:a.mapId,mapName:a.mapName},B.set(a.mapId,b));"jsonLoaded"==a.op&&"mapConfig"==a.name&&(b.mapName=a.json.data_configuration.map_information.name);return b};x.prototype.getTileLoaderGetter=function(a){const b=
this.worker;return function(e){return function(d){w&&console.log("loadTile "+a,{job:d});d.mapId=a;b.postMessage({op:"loadTile",job:d})}}};x.prototype.noteInitialized=function(){this.mapsInitialized++;w&&console.log(`WebLoader: ${this.mapsInitialized}/${this.mapCount} maps initialized`);this.mapsInitialized==this.mapCount&&this.ngChmsLoaded.call(null,[...B.values()])};x.prototype.connectMessageHandler=function(){w&&console.log("Connecting worker message handler");const a=this;this.setMessageHandler(function(b){w&&
console.log("Received message from WebLoader: "+b.data.op,{data:b.data});b.data.mapId||console.warn("webworker message does not have expected heatmap id");b.data.mapName||["tileLoaded","tileLoadFailed"].includes(b.data.op)||console.warn("webworker message does not have expected heatmap name");const e=a.getHeatMap(b.data);if("tileLoaded"===b.data.op){const d=new Float32Array(b.data.buffer);e.tileRequestComplete(b.data.job.tileCacheName,d)}else"tileLoadFailed"===b.data.op?e.tileRequestComplete(b.data.job.tileCacheName,
null):"jsonLoaded"===b.data.op?e.addJson(b.data.name,b.data.json):"jsonLoadFailed"===b.data.op?(console.error(`Failed to get JSON file ${b.data.name} for ${b.data.mapName} (${e.mapName}) from server`),v.mapNotFound(e.mapName)):console.error("connectWebLoader: unknown op",{data:b.data})})};x.prototype.loadWebMaps=function(a,b,e){(H||w)&&console.log("Loading web maps",{srcInfo:a});let d="Trying to load web maps but ";if(a.embedded){if(a.options.sourceType==g.WEB_SOURCE){a.fileSrc=g.WEB_SOURCE;a.mapIds=
a.spec.split(",");a.mapNames=[];m.createWorker(a,b,e);m.mapCount=a.mapIds.length;m.openMapsById(a.mapIds);return}d+=`sourceType ${a.options.sourceType} is not an option for embedded maps.`}else{if(0<a.mapIds.length+a.mapNames.length){a.fileSrc=a.options.sourceType==g.API_SOURCE?g.API_SOURCE:g.WEB_SOURCE;m.mapCount=a.mapIds.length+a.mapNames.length;m.createWorker(a,b,e);0<a.mapIds.length&&m.openMapsById(a.mapIds);0<a.mapNames.length&&m.openMapsByName(a.mapNames);return}d+="no mapIds or mapNames were specified"}v.mapLoadError("",
d)};g.zipSaveMapProperties=function(a,b,e){function d(f){function k(r){for(const t of g.getAllHeatMaps())if(t.getMapInformation().name==r)return t;return null}function p(r){return r.getData(new zip.TextWriter).then(t=>q(r.filename,t))}function u(r){return r.getData(new zip.BlobWriter).then(t=>f.add(r.filename,new zip.BlobReader(t)))}function q(r,t){return f.add(r,new zip.TextReader(t))}return new Promise((r,t)=>{function c(y){var l=(1+y)/(1+h.length);e&&(e(l)||t("Cancelled by user"));if(y==h.length)r(f);
else{var n=h[y];l=m.zipFiles[n];0<=n.indexOf("bin")||0<=n.indexOf("tile")?l=u(l):0<n.indexOf("/mapConfig.json")?(n=n.substring(0,n.indexOf("/mapConfig.json")),n=k(n),l=q(l.filename,JSON.stringify(a==n?b||a.mapConfig:n.mapConfig))):0<=n.indexOf("/mapData.json")?(n=n.substring(0,n.indexOf("/mapData.json")),n=k(n),l=q(l.filename,JSON.stringify(n.mapData))):l=p(l);l.then(()=>c(y+1))}}const h=Object.keys(m.zipFiles);c(0)})}return(new Promise((f,k)=>{f(new zip.ZipWriter(new zip.BlobWriter))})).then(f=>
d(f)).then(f=>f.close()).then(f=>{saveAs(f,a.mapName+".ngchm");return!0}).catch(f=>{if("Cancelled by user"!=f){const k=v.newMessageBox("error-saving-ngchm");k.style.width="20em";v.setNewMessageBoxHeader(k,"Failed to save NG-CHM");v.getNewMessageTextBox(k).innerHTML="<P><B>The NG-CHM was not saved.</B></P><P>The following error details were recorded:</P><P><B>"+f+"</B></P>";v.setNewMessageBoxButton(k,"close",{type:"text",text:"Close",tooltip:"Closes this dialog",default:!0});v.displayNewMessageBox(k)}return!1})};
g.webSaveMapProperties=function(a){const b=JSON.stringify(a.getMapConfig());var e="false";a=g.getApi()+"SaveMapProperties?map="+a.mapName;var d=new XMLHttpRequest;d.open("POST",a,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){d.readyState==d.DONE&&(200!=d.status?(console.log("Failed in call to save properties from server: "+d.status),e="false"):e=d.response)};d.send(b);return e};g.zipMapProperties=function(a,b){a=g.getApi()+"ZippedMap?map="+a.loadSpec.mapId;
E("POST",a,b);return!0};z.prototype.readZipFile=async function(a,b,e){if(0===a.size)v.mapLoadError(a.name,"File is empty (zero bytes)");else{var d=this;return(new zip.ZipReader(new zip.BlobReader(a))).getEntries().then(function(f){if(0==f.length)throw"Empty zip file";const k=[];for(let u=0;u<f.length;u++){var p=f[u].filename;d.zipFiles[p]=f[u];const q=p.indexOf("/");0<q&&(p=p.substring(0,q),k.includes(p)||k.push(p))}for(const u of k)u+"/mapConfig.json"in d.zipFiles&&d.mapNames.push(u);if(0==d.mapNames.length)throw"File format not recognized";
d.createHeatMaps(b,e)}).catch(function(f){console.error("Error opening zip file: "+f);v.mapLoadError(a.name,f)})}};z.prototype.createHeatMaps=function(a,b){function e(){k++;k==d&&b(f)}const d=this.mapNames.length,f=[];let k=0;for(const p of this.mapNames)f.push(new F.HeatMap(p,a,this.getTileLoaderGetter(),e))};z.prototype.loadConfigFiles=function(a){const b=a.mapName+"/mapData.json";a.mapName+"/mapConfig.json"in this.zipFiles&&b in this.zipFiles?(setTimeout(()=>{this.zipFetchJson(a,"mapConfig")}),
setTimeout(()=>{this.zipFetchJson(a,"mapData")})):v.mapLoadError(a.mapName,"Missing NG-CHM content")};z.prototype.zipFetchJson=function(a,b){this.zipFiles[`${a.mapName}/${b}.json`].getData(new zip.TextWriter,{}).then(e=>{a.addJson(b,JSON.parse(e))})};z.prototype.getTileLoaderGetter=function(){const a=this;return function(b){a.loadConfigFiles(b);return function(e){a.fetchTile(b,e)}}};z.prototype.fetchTile=function(a,b){const e=a.mapName+"/"+b.layer+"/"+b.level+"/"+b.tileName;let d=this.zipFiles[e+
".tile"];"undefined"===typeof d&&(d=this.zipFiles[e+".bin"]);"undefined"===typeof d?(console.error("Request for unknown zip tile: "+e),a.tileRequestComplete(b.tileCacheName,null)):setTimeout(function(){d.getData(new zip.BlobWriter).then(function(f){const k=new FileReader;k.onerror=function(){console.error("Error in zip file reader",k.error);a.tileRequestComplete(b.tileCacheName,null)};k.onload=function(p){p=new Float32Array(k.result);a.tileRequestComplete(b.tileCacheName,p)};k.readAsArrayBuffer(f)}).catch(f=>
{console.error("Error getting zip tile data",f)})},1)};var A=[],D=null;g.getHeatMap=function(){return D};g.getAllHeatMaps=function(){return A};g.hasUnsavedChanges=function(){for(const a of A)if(a.getUnAppliedChanges())return!0;return!1};g.hasReadOnlyChanges=function(){for(const a of A)if(D.isReadOnly()&&a.getUnAppliedChanges())return!0;return!1};g.clearUnsavedChanges=function(){for(const a of A)a.setUnAppliedChanges(!1)};g.mapUpdatedOnLoad=function(){for(const a of A)if(a.mapUpdatedOnLoad)return!0;
return!1};g.loadWebMaps=function(a,b,e){m=new x;m.loadWebMaps(a,b,G(e))};g.loadZipMaps=function(a,b,e){m=new z;m.readZipFile(a,b,G(e))};function G(a){return function(b){A=b;D=A[0];a()}}})();
(function(){NgChm.markFile();const q=NgChm.createNS("NgChm.DDR");NgChm.importNS("NgChm.MAPREP");NgChm.importNS("NgChm.MMGR");q.maxDendroHeight=3E3;q.minDendroHeight=500;q.minDendroWidth=500;q.Dendrogram=function(g){this.bars=[];this.dendroCanvas=g;this.getDivWidth=function(){return this.dendroCanvas.clientWidth+2*("Row"===this.axis)};this.getDivHeight=function(){return this.dendroCanvas.clientHeight+2*("Column"===this.axis)};this.getConfigSize=function(){return this.dendroConfig.height/q.minDendroHeight};
this.checkDendroHit=function(b,c,d){function a(k,e,n,p,r){e<=l&&n<=h&&(k=e*e+n*n,k<f&&(f=k,m=this.getLocalBarIndex(p,r)))}const h=this.dendroViewHeight/20,l=this.dendroViewWidth/60;let f=1E10,m=-1;for(let k=0;k<this.bars.length;k++){const e=this.bars[k];let n=c<e.left?e.left-c:c>e.right?c-e.right:0,p=Math.abs(b-e.height);a.call(this,"b",n,p,-1,k);n=Math.abs(c-e.left);p=b<e.leftBot?e.leftBot-b:b>e.height?b-e.height:0;a.call(this,"l",n,p,this.dendroData[e.idx].left-1,k);n=Math.abs(c-e.right);p=b<e.rightBot?
e.rightBot-b:b>e.height?b-e.height:0;a.call(this,"r",n,p,this.dendroData[e.idx].right-1,k)}-1!==m&&d(m)};this.setCanvasSize=function(b,c){this.dendroCanvas.width=b;this.dendroCanvas.height=c};this.timeout=null;this.drawView=function(){null==this.timeout&&this.debouncedDraw&&setTimeout(()=>{this.debouncedDraw();this.timeout=null})}};q.ColumnDendrogram=function(){this.axis="Column";this.canvasEventPosn=function(g){return{w:event.offsetX/this.dendroCanvas.clientWidth,h:(this.dendroCanvas.clientHeight-
event.offsetY)/this.dendroCanvas.clientHeight}};this.drawPDF=function(g,b){function c(f){const m=a(f.left*l),k=a(f.right*l);var e=a(h-f.height*h);const n=a(f.leftBot*h);f=a(f.rightBot*h);0<=e&&e<h&&(d.moveTo(Math.max(0,m),e),d.lineTo(Math.min(l,k),e));e=Math.min(Math.max(0,e),h-1);0<=m&&m<l&&n<h&&(d.moveTo(m,e),d.lineTo(m,h-1-n));0<=k&&k<l&&f<h&&(d.moveTo(k,e),d.lineTo(k,h-1-f))}g.setDrawColor(0);const d=g.context2d;d.save();g.setLineCap("square");g.setLineJoin("square");const a=Math.floor,h=a(100*
b.height),l=a(100*b.width);d.translate(b.left,b.top);d.scale(.01,.01);g=this.getScaledView();b=g.filter(f=>1===f.thickness);0<b.length&&(d.beginPath(),d.lineWidth=0,b.forEach(c),d.stroke());g=g.filter(f=>2===f.thickness);0<g.length&&(d.beginPath(),d.lineWidth=100,g.forEach(c),d.stroke());d.restore()};this.debouncedDraw=function(){const g=Math.floor,b=this.dendroCanvas.getContext("2d"),c=this.dendroCanvas.height,d=this.dendroCanvas.width;b.fillStyle="black";b.imageSmoothingEnabled=!1;b.clearRect(0,
0,d,c);this.getScaledView().forEach(a=>{const h=g(a.left*d),l=g(a.right*d);var f=g(c-a.height*c);const m=g(a.leftBot*c),k=g(a.rightBot*c);if(f<c){const e=Math.max(0,h);b.fillRect(e,f,Math.min(d,l+1)-e,a.thickness)}f=Math.min(Math.floor(a.height*c),c);0<=h&&h<d&&m<c&&b.fillRect(h,c-f,a.thickness,f-m);0<=l&&l<d&&k<c&&b.fillRect(l,c-f,a.thickness,f-k)})}};q.RowDendrogram=function(){this.axis="Row";this.canvasEventPosn=function(g){return{w:event.offsetY/this.dendroCanvas.clientHeight,h:(this.dendroCanvas.clientWidth-
event.offsetX)/this.dendroCanvas.clientWidth}};this.drawPDF=function(g,b){function c(m){const k=d(m.left*h),e=d(m.right*h);var n=d(l-m.height*l);const p=d(m.leftBot*l);m=d(m.rightBot*l);0<=n&&n<l&&(a.moveTo(n,Math.max(0,k)),a.lineTo(n,Math.min(h,e)));n=Math.min(Math.max(0,n),l-1);0<=k&&k<h&&p<l&&(a.moveTo(n,k),a.lineTo(l-1-p,k));0<=e&&e<h&&m<l&&(a.moveTo(n,e),a.lineTo(l-1-m,e))}const d=Math.floor;g.setDrawColor(0);const a=g.context2d;a.save();g.setLineCap("square");g.setLineJoin("square");a.translate(b.left,
b.top);a.scale(.01,.01);const h=d(100*b.height),l=d(100*b.width);b=this.getScaledView();const f=b.filter(m=>1===m.thickness);0<f.length&&(a.beginPath(),g.setLineWidth(0),f.forEach(c),a.stroke());b=b.filter(m=>2===m.thickness);0<b.length&&(a.beginPath(),g.setLineWidth(100),b.forEach(c),a.stroke());a.restore()};this.debouncedDraw=function(){const g=Math.floor,b=this.dendroCanvas.getContext("2d"),c=this.dendroCanvas.width,d=this.dendroCanvas.height;b.fillStyle="black";b.imageSmoothingEnabled=!1;b.clearRect(0,
0,c,d);this.getScaledView().forEach(a=>{const h=g(a.left*d),l=g(a.right*d);var f=g(c-a.height*c);const m=g(a.leftBot*c),k=g(a.rightBot*c);f<c&&b.fillRect(f,Math.max(0,h),a.thickness,Math.min(d,l+1)-Math.max(0,h));f=Math.min(Math.floor(a.height*c),c);0<=h&&h<d&&m<c&&b.fillRect(c-f,h,f-m,a.thickness);0<=l&&l<d&&k<c&&b.fillRect(c-f,l,f-k,a.thickness)})}}})();
(function(){function n(a){let b=c.getGapItems(a);if(!b){let e=p.getHeatMap().getAxisLabels(a).labels;b={};e.forEach((d,f)=>{""==d&&(b[f+1]=!0)});c.setGapItems(a,b)}return b}NgChm.markFile();const c=NgChm.createNS("NgChm.SRCHSTATE"),q=NgChm.importNS("NgChm.UTIL"),r=NgChm.importNS("NgChm.MAPREP"),p=NgChm.importNS("NgChm.MMGR"),g={Row:{},Column:{},RowCovar:{},ColumnCovar:{}};var k=new WeakMap;const l={},m={};c.getSearchSaveState=function(){const a={};a.row=c.getAxisSearchResults("Row");a.col=c.getAxisSearchResults("Column");
return a};c.getGapItems=function(a){return a in m?m[a]:null};c.getDiscreteState=function(a){return l.hasOwnProperty(a)?l[a]:null};c.getCurrentSearchItem=function(a){return k.get(a)||{}};c.getAxisSearchResults=function(a){r.isRow(a)&&(a="Row");"column"==a&&(a="Column");return Object.keys(g[a]).map(b=>+b)};c.getSearchResults=function(a){return g[a]};c.labelIndexInSearch=function(a,b){return null!=b&&null!=a&&1==g[a][b]};c.getSearchLabelsByAxis=function(a,b){let e=[];const d=p.getHeatMap(),f="Row"==
a?d.getRowLabels().labels:"Column"==a?d.getColLabels().labels:"ColumnCovar"==a?Object.keys(d.getColClassificationConfig()):"RowCovar"==a?Object.keys(d.getRowClassificationConfig()):[d.getRowLabels().labels,d.getColLabels().labels];c.getAxisSearchResults(a).forEach(h=>{a.includes("Covar")?b==linkouts.VISIBLE_LABELS?e.push(f[h].split("|")[0]):b==linkouts.HIDDEN_LABELS?e.push(f[h].split("|")[1]):e.push(f[h]):b==linkouts.VISIBLE_LABELS?e.push(f[h-1].split("|")[0]):b==linkouts.HIDDEN_LABELS?e.push(f[h-
1].split("|")[1]):e.push(f[h-1])});return e};c.clearAllSearchResults=function(){g.Row={};g.Column={};g.RowCovar={};g.ColumnCovar={};k=new WeakMap;l.Row="";l.Column="";for(let a in m)delete m[a]};c.setGapItems=function(a,b){m[a]=b};c.setDiscreteState=function(a,b){l[a]=b};c.clearAllCurrentSearchItems=function(){k=new WeakMap};c.setSearchItem=function(a,b,e){let d=k.get(a);d||(d={},k.set(a,d));d.axis=b;d.index=e};c.setAxisSearchResults=function(a,b,e){const d=g[a];for(a=n(a);b<=e;b++)a[b]||(d[b]=1)};
c.setAxisSearchResultsVec=function(a,b){a=q.capitalize(a);const e=g[a],d=n(a);b.forEach(f=>{d[f]||(e[f]=1)})};c.clearSearchRange=function(a,b,e){for(b=+b;b<+e+1;b++)delete g[a][b]};c.clearAllAxisSearchItems=function(a){g[a]={}}})();
